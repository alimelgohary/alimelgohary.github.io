<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;500&#038;display=swap" rel="stylesheet" />

    <!-- font family -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Salsa&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="css/Normalize.css">
    <link rel="stylesheet" href="css/imagehover.min.css">
    <link rel="stylesheet" href="css/imagehover.css">
    <link rel="stylesheet" href="css/all.min.css" />
    <link rel="stylesheet" href="css/framework.css">
    <link rel="stylesheet" href="css/master.css">
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/animate.min.css">
    <link rel="stylesheet" href="css/hover.css">
    <link rel="stylesheet" href="css/home.css">
    <title>Post</title>
    <link rel="icon" type=" image/svg+xml" href="imgs/logo.svg" />


</head>

<body class="home-bg">




    <div class="container-fluid mt-30">
        <div class="w-full d-flex justify-content-between">
            
            <div class="home-pages bg-white position-sticky rad-10" style="opacity: 0;">
                
            </div>

            <div class="home-content ">
                <div class="home-posts mt-25 ">
                    
                </div>
                
                <div class="loading-div mb-20">
                    <div class="skeleton-loading bg-white rad-10 shadow-lg d-none">
                        <div class="skeleton-loading__content">
                            <div class="skeleton-loading__info">
                                <div class="d-flex align-center mb-30">
                                    <div class="skeleton-loading__image"></div>
                                    <div class="skeleton-loading__name"></div>
                                </div>
                                <div class="skeleton-loading__title"></div>
                                <div class="skeleton-loading__description"></div>
                                <div class="skeleton-loading__text"></div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>

            <div class="home-chats bg-white rad-10" style="opacity: 0;">

            </div>
        </div>
    </div>





    <script src="js/bootstrap.bundle.min.js "></script>
    <script src="js/all.min.js "></script>
    <script src="js/popper.min.js "></script>
    <script src="js/helper.js "></script>
    <script src="js/jquery-3.6.1.min.js "></script>

    <script>
        (async() => {
            let apiUrl = await GetServerDomain();
            let language;
            let PostId = window.location.href.split("Id=")[1];
            if (window.localStorage.getItem("language") == null) {
                language = "en";
            } else {
                language = window.localStorage.getItem("language");
            }



            $.ajax({
                "method": "GET",
                "url": apiUrl + `/api/Public/GetPost?Id=${PostId}`,
                "xhrFields": {
                    "withCredentials": true
                },
                "headers": {
                    "Content-Type": "application/json",
                    "ngrok-skip-browser-warning": "69420",
                    "Accept-Language": language
                },
                beforeSend: function() {
                    $(".skeleton-loading").removeClass("d-none");
                },
                success: function(data, st, xhr) {
                    console.log(data);
                    console.log(PostId);
                    $(".skeleton-loading").addClass("d-none");
                    if (data.isCase == true) {

                        $(".social-link").click(function(e) {
                            let copiedinput = $(this).find('input')[0];
                            copiedinput.select();
                            document.execCommand('copy');
                            copiedinput.blur();

                        })
                        var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
                        var tooltipList = tooltipTriggerList.map(function(tooltipTriggerEl) {
                            return new bootstrap.Tooltip(tooltipTriggerEl)
                        })

                        //   facebook seemore effect 
                        var showMoreLinks = document.querySelectorAll('.seemore');
                        var maxChars = 150;
                        showMoreLinks.forEach(link => {
                            var postText = link.closest('.post-text');
                            var postDescription = postText.querySelector('.post-description');
                            var descriptionText = postDescription.textContent.trim();
                            var truncatedText = descriptionText.substring(0, maxChars).trim() + '...';
                            if (descriptionText.length <= maxChars) {
                                link.style.display = 'none';
                            } else {
                                postDescription.textContent = truncatedText;
                            }
                            link.addEventListener('click', (event) => {
                                event.preventDefault();
                                if (postDescription.textContent === truncatedText) {
                                    postDescription.textContent = descriptionText;
                                    link.textContent = 'Show less';
                                } else {
                                    postDescription.textContent = truncatedText;
                                    link.textContent = 'See more';
                                }
                            });
                        });

                        $(".moreimg").click(function() {
                            $(this).toggleClass("rotate-90");
                            $(this).next("ul").toggleClass("d-none");
                        })

                        $(`.share-links`).click(function() {
                            $(this).next(`button`).trigger("click");
                        })

                        $(`.block`).click(function() {
                            $(this).next(`button`).trigger("click");
                        })

                        $(`.report`).click(function() {
                            $(this).next(`button`).trigger("click");
                        })


                        //request of report button
                        $(`.reportbuton`).click(function(e) {
                            e.preventDefault();
                            let postId = $(this).attr("data-post-id");
                            let parentofButton = $(this).parent();
                            let perviosDiv = parentofButton.prev()[0];
                            let textarea = $(perviosDiv).find('textarea')[0];
                            let reason = $(textarea).val();

                            let button = $(this);

                            console.log(reason);
                            console.log(postId);
                            let reportObj = {
                                "reported_post_id": postId,
                                "reason": reason
                            }

                            let jsonData = JSON.stringify(reportObj);

                            if (reason.length == 0 || reason == null) {
                                delete reportObj.reason
                            }
                            $.ajax({
                                "method": "POST",
                                "url": apiUrl + "/api/Common/ReportPost",
                                "xhrFields": {
                                    "withCredentials": true
                                },
                                "headers": {
                                    "Content-Type": "application/json",
                                    "ngrok-skip-browser-warning": "69420",
                                    "Accept-Language": language
                                },
                                "data": jsonData,

                                success: function(data, st, xhr) {
                                    console.log(data);
                                    let buttondiv = $(button).parent()[0];
                                    let errordiv = $(buttondiv).next('div')[0]
                                    let errorspan = $(errordiv).find('span')[0];
                                    $(errorspan).css("color", "green")
                                    $(errorspan).text("Report Sent Sucssfully")

                                    setTimeout(function() {
                                        let Cancelbutton = $(button).next(`.reportbutoncancel`)[0];
                                        $(Cancelbutton).trigger('click');
                                    }, 2000)


                                },
                                error: function(xhr, status, err) {
                                    let buttondiv = $(button).parent()[0];
                                    let errordiv = $(buttondiv).next('div')[0]
                                    let errorspan = $(errordiv).find('span')[0];
                                    $(errorspan).css("color", "red")
                                    $(errorspan).text(xhr.responseJSON.error)

                                    setTimeout(function() {
                                        let Cancelbutton = $(button).next(`.reportbutoncancel`)[0];
                                        $(Cancelbutton).trigger('click');
                                    }, 2000)

                                }
                            })
                        });


                        //request of block button
                        $(`.blockbutton`).click(function(e) {
                            e.preventDefault();
                            userId = $(this).attr("data-user-id");
                            let blockbutton = $(this)
                            let blockObj = {
                                "blocked_user_id": userId
                            }
                            let jsonData = JSON.stringify(blockObj);

                            $.ajax({
                                "method": "POST",
                                "url": apiUrl + "/api/Common/BlockUser?blocked_user_id=" + userId,
                                "xhrFields": {
                                    "withCredentials": true
                                },
                                "headers": {
                                    "Content-Type": "application/json",
                                    "ngrok-skip-browser-warning": "69420",
                                    "Accept-Language": language
                                },


                                success: function(data, st, xhr) {
                                    console.log(data);
                                    let buttondiv = $(blockbutton).parent()[0];
                                    let errordiv = $(buttondiv).next('div')[0]
                                    let errorspan = $(errordiv).find('span')[0];
                                    $(errorspan).css("color", "green")
                                    $(errorspan).text("User is blocked")
                                    setTimeout(function() {
                                        let Cancelbutton = $(blockbutton).next(`.blockbuttoncancel`)[0];
                                        $(Cancelbutton).trigger('click');
                                    }, 2000)

                                },
                                error: function(xhr, status, err) {
                                    if (xhr.status == 400) {
                                        let buttondiv = $(blockbutton).parent()[0];
                                        let errordiv = $(buttondiv).next('div')[0]
                                        let errorspan = $(errordiv).find('span')[0];
                                        $(errorspan).css("color", "red")
                                        $(errorspan).text(xhr.responseJSON.error)


                                    } else {
                                        let buttondiv = $(blockbutton).parent()[0];
                                        let errordiv = $(buttondiv).next('div')[0]
                                        let errorspan = $(errordiv).find('span')[0];
                                        $(errorspan).css("color", "red")
                                        $(errorspan).text("Something went wrong, please try again")

                                    }


                                }
                            })

                        });



                        $(".home-posts").append(`<div class="home-post" id="${data.postId}">
                        <div class="mb-30 post-body d-flex flex-column p-30 bg-white  rad-10">
                            <div class="post-head d-flex justify-content-between">
                                <div class="post-user-info d-flex flex-row">
                                    <div class="user-image rad-half mr-10">
                                        <img src="imgs/profilepic.svg" class = "profile${data.postId} rad-half" alt="" style="max-width: 100%;">
                                    </div>
                                    <div class="post-info d-flex flex-column">
                                        <div class="d-flex usernames align-center">
                                            <span class="fs-rem-14 fw-bold name">${data.userInfo.fullName}</span><span class="username fs-rem-12 c-grey">@${data.userInfo.username}</span></div>
                                     
                                        <span class="user-mohafza c-grey fs-rem-10">${data.governorate}</span>
                                        <div>
                                            <span class="post-time c-grey fs-rem-10 mr-px-5">${data.timeWritten}</span><span class="fs-rem-10 c-grey mr-px-5 edited">Edited at</span><span class="editedtime${data.postId} edited fs-rem-10 c-grey">8</span></div>
                                        <div class="casetype-bg p-1 txt-c w-fit case-type-rad"><span class="case-type c-white casetype-bg fs-rem-11  overflow-hidden" title = "${data.category}" >${data.category}</span></div>
                                    </div>
                                </div>
                                <div class="more-about-post d-flex flex-column align-items-end">
                                    <img src="imgs/more.svg" class="moreimg cur-point" style="width: 30px; max-width: 35px;">
                                    <ul class="p-10 dropbutton-bg mt-px-5 d-none">
                                        <li class="p-10 share-links${data.postId} share-links">Share via</li>
                                        <!-- share moadale -->

                                        <!-- Button trigger modal -->
                                        <button type="button" class="btn btn-primary d-none sharemodal " data-bs-toggle="modal" data-bs-target="#exampleModal${data.postId}">
                                                Launch demo modal
                                        </button>

                                        <!-- Modal -->
                                        <div class="modal fade" id="exampleModal${data.postId}" tabindex="-1" aria-labelledby="exampleModalLabel${data.postId}" aria-hidden="true">
                                            <div class="modal-dialog modal-dialog-centered">
                                                <div class="modal-content sharemodal-bg">
                                                    <div class="modal-header">
                                                        <h5 class="modal-title c-white" id="exampleModalLabel${data.postId}">Share</h5>
                                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                    </div>
                                                    <div class="modal-body">
                                                        <div class="social-media-icons row flex-row p-20">
                                                            <div class="col-6 col-md-3 p-0 p-1 cur-point share-icon post1" style="width: fit-content;">
                                                                <a class="whatsapp${data.postId}" target="_blank"> <img src="imgs/what's-share.svg" alt="" style="max-width: 100%;"></a>
                                                            </div>
                                                            <div class="col-6 col-md-3 p-0 p-1 cur-point  share-icon" style="width: fit-content;">
                                                                <a class="facebook-share${data.postId}" target="_blank"> <img src="imgs/facebook-share.svg" alt="" style="max-width: 100%;"></a>
                                                            </div>
                                                            <div class="col-6 col-md-3 p-0 p-1 cur-point  share-icon" style="width: fit-content;">
                                                                <a class="twitter-share${data.postId}" target="_blank" > <img src="imgs/twitter-share.svg" alt="" style="max-width: 100%;"></a>
                                                            </div>
                                                        </div>

                                                        <div class=" social-link cur-point mt-20 w-100 p-px-5 d-flex align-center justify-content-between" data-post-id ="${data.postId}">
                                                            <input class="overflow-hidden cur-point w-80 copied-link " readonly id="share-link${data.postId}"  data-post-id ="${data.postId}">
                                                            <span class="copy cur-point">Copy</span>

                                                        </div>
                                                    </div>

                                                </div>
                                            </div>
                                        </div>

                                        <li class="p-10 report">report</li>

                                        <!-- report moadale -->

                                        <!-- Button trigger modal -->
                                        <button type="button" class="btn btn-primary d-none reportmodal" data-bs-toggle="modal" data-bs-target="#exampleModal100${data.postId}">
                                            Launch demo modal
                                        </button>

                                        <!-- Modal -->
                                        <div class="modal fade" id="exampleModal100${data.postId}" tabindex="-1" aria-labelledby="exampleModalLabel100${data.postId}" aria-hidden="true">
                                            <div class="modal-dialog modal-lg">
                                                <div class="modal-content rad-20 d-flex justify-content-center align-center p-50 reportmodal-bg">

                                                    <div class="modal-body reportmodaldiv w-70 case-bg">
                                                        <div class="d-flex ">
                                                            <p>Report <span class="reporteduser c-grey">@${data.userInfo.username}â€™s post</span></p>
                                                        </div>
                                                        <div>
                                                            <form>


                                                                <div class="mb-3 w-100">

                                                                    <textarea  placeholder="The reason of report" class="form-control reportarea${data.postId}" id="exampleFormControlTextarea2${data.postId}" rows="10"></textarea>

                                                                </div>

                                                                <div class="modal-footer d-flex justify-content-evenly">
                                                                    <input type="submit" class="btn btn-primary reportbuton rad-25 p-30 shadow" data-post-id="${data.postId}">
                                                                    <button type="button" class="btn btn-secondary rad-25 reportbutoncancel shadow" data-bs-dismiss="modal">Cancel</button>
                                                                </div>
                                                                <div class = "mt-30 ">
                                                                <span class="reporterror  txt-c  fs-rem-14 d-block"></span>    
                                                                </div>

                                                                
                                                            </form>
                                                        </div>


                                                    </div>

                                                </div>
                                            </div>
                                        </div>

                                        <li class="p-10 block  lastli">block</li>
                                        <!-- block moadale -->

                                        <!-- Button trigger modal -->
                                        <button type="button" class="btn btn-primary d-none blockmodal" data-bs-toggle="modal" data-bs-target="#exampleModal1000${data.postId}">
                                            Launch demo modal
                                        </button>

                                        <!-- Modal -->
                                        <div class="modal fade" id="exampleModal1000${data.postId}" tabindex="-1" aria-labelledby="exampleModalLabel1000${data.postId}" aria-hidden="true">
                                            <div class="modal-dialog modal-dialog-centered blockmodaldiv">
                                                <div class="modal-content rad-20">

                                                    <div class="modal-body">
                                                        <p class="fw-bold txt-c">Are you sure you want to block<span class="c-grey blockedusername">@${data.userInfo.username}</span> ?</p>
                                                    </div>
                                                    <div class="modal-footer d-flex justify-content-evenly">
                                                        <button type="button" class="btn btn-primary blockbutton   rad-25 p-30 shadow " data-user-id="${data.userInfo.userId}">Yes</button>
                                                        <button type="button" class="btn btn-secondary rad-25 blockbuttoncancel shadow" data-bs-dismiss="modal">No</button>

                                                    </div>
                                                    <div class = "mt-30 mb-20">
                                                    <span class = "blockerror blockerror c-red txt-c fs-rem-14 d-block"></span>    
                                                    </div>
                                                </div>
                                            </div>
                                        </div>


                                    </ul>
                                </div>
                            </div>
                            <div class="post-text">
                                <h3 class="post-title">${data.title}</h3>
                                <p class="m-0 d-inline post-description d-flex" style="white-space: pre; max-width:100%; text-wrap: wrap;">${data.body}</p><span class="cur-point seemore">... See more</span>
                            </div>
                           <div class="post-images post-images${data.postId}">
                                <div class="d-flex w-100 mt-40 justify-content-center">
                                  
                                    <div id="carouselExampleControls${data.postId}" class="carousel slide w-100" data-bs-ride="carousel">
                                            <div class="carousel-inner images${data.postId} ">
                                              
                                               
                                            </div>
                                            <button class="carousel-control-prev carousel-control-prev${data.postId}" type="button" data-bs-target="#carouselExampleControls${data.postId}" data-bs-slide="prev">
                                                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                                <span class="visually-hidden">Previous</span>
                                            </button>
                                            <button class="carousel-control-next carousel-control-next${data.postId}" type="button" data-bs-target="#carouselExampleControls${data.postId}" data-bs-slide="next">
                                                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                                <span class="visually-hidden">Next</span>
                                            </button>
                                            </div>

                                </div>

                            </div>
                            <div class="post-call mt-40">
                                <div class="w-full d-flex justify-content-between align-center">
                                    <div class="call call${data.postId}">
                                        <button type="button" class="btn btn-secondary button-bg " data-bs-toggle="tooltip" data-bs-placement="top" title="01016218389">
                                           <i class="fa-solid fa-phone-volume hvr-buzz mr-px-5"></i> <span>Call</span>
                                        </button>
                                    </div>
                                    <div class="chat">
                                        <a href = "../chat.html?id=${data.userInfo.userId}">
                                        <button type="button" class="btn btn-secondary button-bg " data-bs-placement="top">
                                           <i class="fa-regular fa-comment mr-px-5"></i> <span>Chat</span>
                                        </button>
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>`)


                        // check if there is phone or not 
                        if (data.phone == null) {
                            $(`.call${data.postId} button`).attr('disabled', 'disabled');
                        } else {
                            $(`.call${data.postId} button`).attr('title', data.phone);
                        }

                        // check if Post is edited or not
                        if (data.timeUpdated == null) {
                            $(".edited").css("display", "none");
                        } else {
                            $(`editedtime${data.postId}`).text(data.timeUpdated)
                        }

                        // check if user have profile pic or not
                        if (data.userInfo.profilePicture == null) {} else {
                            $(`.profile${data.postId}`).attr("src", `data:image/png;base64,${data.userInfo.profilePicture}`);
                        }

                        //check if user have images and display it
                        if (data.images == null || data.images.length == 0) {
                            $(`.images${data.postId}`).css("display", "none");
                        } else {
                            for (var i = 0; i < data.images.length; i++) {
                                console.log(i)
                                let activeClass = i == 0 ? "active" : " ";
                                $(`.images${data.postId}`).append(`<div class="carousel-item  ${activeClass}">
                                                <img src="data:image/png;base64,${data.images[i]}" class="h-full w-full control-slider-img-width" alt="" style="max-width:100%; max-height:300px;">
                                                </div>`)
                            }
                        }

                        if (data.images.length == 1) {

                            $(`.carousel-control-prev${data.postId}`).addClass('d-none');
                            $(`.carousel-control-next${data.postId}`).addClass('d-none');
                        }








                        let everyPostId = $(`#share-link${data.postId}`).attr("data-post-id");
                        $(`#share-link${data.postId}`).val("http://freesmile.me/en/posts.html" + `?Id=${everyPostId}`);


                        var link = encodeURI("http://freesmile.me/en/posts.html" + `?Id=${everyPostId}`);
                        var msg = encodeURIComponent('Hey, I found this article');
                        var title = encodeURIComponent('Article or Post Title Here');

                        var fb = document.querySelector(`.facebook-share${data.postId}`);
                        fb.href = `https://www.facebook.com/share.php?u=${link}`;

                        var twitter = document.querySelector(`.twitter-share${data.postId}`);
                        twitter.href = `http://twitter.com/share?&url=${link}&text=${msg}&hashtags=javascript,programming`;

                        var whatsapp = document.querySelector(`.whatsapp${data.postId}`);
                        whatsapp.href = `https://api.whatsapp.com/send?text=${msg}: ${link}`;



                        // end of for loop






                        $(".social-link").click(function(e) {
                            let copiedinput = $(this).find('input')[0];
                            copiedinput.select();
                            document.execCommand('copy');
                            copiedinput.blur();

                        })




                        //enable tolltip of bootstrap
                        var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
                        var tooltipList = tooltipTriggerList.map(function(tooltipTriggerEl) {
                            return new bootstrap.Tooltip(tooltipTriggerEl)
                        })

                        //   facebook seemore effect 
                        var showMoreLinks = document.querySelectorAll('.seemore');
                        var maxChars = 150;
                        showMoreLinks.forEach(link => {
                            var postText = link.closest('.post-text');
                            var postDescription = postText.querySelector('.post-description');
                            var descriptionText = postDescription.textContent.trim();
                            var truncatedText = descriptionText.substring(0, maxChars).trim() + '...';
                            if (descriptionText.length <= maxChars) {
                                link.style.display = 'none';
                            } else {
                                postDescription.textContent = truncatedText;
                            }
                            link.addEventListener('click', (event) => {
                                event.preventDefault();
                                if (postDescription.textContent === truncatedText) {
                                    postDescription.textContent = descriptionText;
                                    link.textContent = 'Show less';
                                } else {
                                    postDescription.textContent = truncatedText;
                                    link.textContent = 'See more';
                                }
                            });
                        });

                        $(".moreimg").click(function() {
                            $(this).toggleClass("rotate-90");
                            $(this).next("ul").toggleClass("d-none");
                        })

                        $(`.share-links`).click(function() {
                            $(this).next(`button`).trigger("click");
                        })

                        $(`.block`).click(function() {
                            $(this).next(`button`).trigger("click");
                        })

                        $(`.report`).click(function() {
                            $(this).next(`button`).trigger("click");
                        })


                        //request of report button
                        $(`.reportbuton`).click(function(e) {
                            e.preventDefault();
                            let postId = $(this).attr("data-post-id");
                            let parentofButton = $(this).parent();
                            let perviosDiv = parentofButton.prev()[0];
                            let textarea = $(perviosDiv).find('textarea')[0];
                            let reason = $(textarea).val();

                            let button = $(this);

                            console.log(reason);
                            console.log(postId);
                            let reportObj = {
                                "reported_post_id": postId,
                                "reason": reason
                            }

                            let jsonData = JSON.stringify(reportObj);

                            if (reason.length == 0 || reason == null) {
                                delete reportObj.reason
                            }
                            $.ajax({
                                "method": "POST",
                                "url": apiUrl + "/api/Common/ReportPost",
                                "xhrFields": {
                                    "withCredentials": true
                                },
                                "headers": {
                                    "Content-Type": "application/json",
                                    "ngrok-skip-browser-warning": "69420",
                                    "Accept-Language": language
                                },
                                "data": jsonData,

                                success: function(data, st, xhr) {
                                    console.log(data);
                                    let buttondiv = $(button).parent()[0];
                                    let errordiv = $(buttondiv).next('div')[0]
                                    let errorspan = $(errordiv).find('span')[0];
                                    $(errorspan).css("color", "green")
                                    $(errorspan).text("Report Sent Sucssfully")

                                    setTimeout(function() {
                                        let Cancelbutton = $(button).next(`.reportbutoncancel`)[0];
                                        $(Cancelbutton).trigger('click');
                                    }, 2000)


                                },
                                error: function(xhr, status, err) {
                                    let buttondiv = $(button).parent()[0];
                                    let errordiv = $(buttondiv).next('div')[0]
                                    let errorspan = $(errordiv).find('span')[0];
                                    $(errorspan).css("color", "red")
                                    $(errorspan).text(xhr.responseJSON.error)

                                    setTimeout(function() {
                                        let Cancelbutton = $(button).next(`.reportbutoncancel`)[0];
                                        $(Cancelbutton).trigger('click');
                                    }, 2000)

                                }
                            })
                        });


                        //request of block button
                        $(`.blockbutton`).click(function(e) {
                            e.preventDefault();
                            userId = $(this).attr("data-user-id");
                            let blockbutton = $(this)
                            let blockObj = {
                                "blocked_user_id": userId
                            }
                            let jsonData = JSON.stringify(blockObj);

                            $.ajax({
                                "method": "POST",
                                "url": apiUrl + "/api/Common/BlockUser?blocked_user_id=" + userId,
                                "xhrFields": {
                                    "withCredentials": true
                                },
                                "headers": {
                                    "Content-Type": "application/json",
                                    "ngrok-skip-browser-warning": "69420",
                                    "Accept-Language": language
                                },


                                success: function(data, st, xhr) {
                                    console.log(data);
                                    let buttondiv = $(blockbutton).parent()[0];
                                    let errordiv = $(buttondiv).next('div')[0]
                                    let errorspan = $(errordiv).find('span')[0];
                                    $(errorspan).css("color", "green")
                                    $(errorspan).text("User is blocked")
                                    setTimeout(function() {
                                        let Cancelbutton = $(blockbutton).next(`.blockbuttoncancel`)[0];
                                        $(Cancelbutton).trigger('click');
                                    }, 2000)

                                },
                                error: function(xhr, status, err) {
                                    if (xhr.status == 400) {
                                        let buttondiv = $(blockbutton).parent()[0];
                                        let errordiv = $(buttondiv).next('div')[0]
                                        let errorspan = $(errordiv).find('span')[0];
                                        $(errorspan).css("color", "red")
                                        $(errorspan).text(xhr.responseJSON.error)


                                    } else {
                                        let buttondiv = $(blockbutton).parent()[0];
                                        let errordiv = $(buttondiv).next('div')[0]
                                        let errorspan = $(errordiv).find('span')[0];
                                        $(errorspan).css("color", "red")
                                        $(errorspan).text("Something went wrong, please try again")

                                    }


                                }
                            })

                        });
                    } else if (data.isListing == true) {
                        $(".social-link").click(function(e) {
                            let copiedinput = $(this).find('input')[0];
                            copiedinput.select();
                            document.execCommand('copy');
                            copiedinput.blur();

                        })
                        var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
                        var tooltipList = tooltipTriggerList.map(function(tooltipTriggerEl) {
                            return new bootstrap.Tooltip(tooltipTriggerEl)
                        })

                        //   facebook seemore effect 
                        var showMoreLinks = document.querySelectorAll('.seemore');
                        var maxChars = 150;
                        showMoreLinks.forEach(link => {
                            var postText = link.closest('.post-text');
                            var postDescription = postText.querySelector('.post-description');
                            var descriptionText = postDescription.textContent.trim();
                            var truncatedText = descriptionText.substring(0, maxChars).trim() + '...';
                            if (descriptionText.length <= maxChars) {
                                link.style.display = 'none';
                            } else {
                                postDescription.textContent = truncatedText;
                            }
                            link.addEventListener('click', (event) => {
                                event.preventDefault();
                                if (postDescription.textContent === truncatedText) {
                                    postDescription.textContent = descriptionText;
                                    link.textContent = 'Show less';
                                } else {
                                    postDescription.textContent = truncatedText;
                                    link.textContent = 'See more';
                                }
                            });
                        });

                        $(".moreimg").click(function() {
                            $(this).toggleClass("rotate-90");
                            $(this).next("ul").toggleClass("d-none");
                        })

                        $(`.share-links`).click(function() {
                            $(this).next(`button`).trigger("click");
                        })

                        $(`.block`).click(function() {
                            $(this).next(`button`).trigger("click");
                        })

                        $(`.report`).click(function() {
                            $(this).next(`button`).trigger("click");
                        })


                        //request of report button
                        $(`.reportbuton`).click(function(e) {
                            e.preventDefault();
                            let postId = $(this).attr("data-post-id");
                            let parentofButton = $(this).parent();
                            let perviosDiv = parentofButton.prev()[0];
                            let textarea = $(perviosDiv).find('textarea')[0];
                            let reason = $(textarea).val();

                            let button = $(this);

                            console.log(reason);
                            console.log(postId);
                            let reportObj = {
                                "reported_post_id": postId,
                                "reason": reason
                            }

                            let jsonData = JSON.stringify(reportObj);

                            if (reason.length == 0 || reason == null) {
                                delete reportObj.reason
                            }
                            $.ajax({
                                "method": "POST",
                                "url": apiUrl + "/api/Common/ReportPost",
                                "xhrFields": {
                                    "withCredentials": true
                                },
                                "headers": {
                                    "Content-Type": "application/json",
                                    "ngrok-skip-browser-warning": "69420",
                                    "Accept-Language": language
                                },
                                "data": jsonData,

                                success: function(data, st, xhr) {
                                    console.log(data);
                                    let buttondiv = $(button).parent()[0];
                                    let errordiv = $(buttondiv).next('div')[0]
                                    let errorspan = $(errordiv).find('span')[0];
                                    $(errorspan).css("color", "green")
                                    $(errorspan).text("Report Sent Sucssfully")

                                    setTimeout(function() {
                                        let Cancelbutton = $(button).next(`.reportbutoncancel`)[0];
                                        $(Cancelbutton).trigger('click');
                                    }, 2000)


                                },
                                error: function(xhr, status, err) {
                                    let buttondiv = $(button).parent()[0];
                                    let errordiv = $(buttondiv).next('div')[0]
                                    let errorspan = $(errordiv).find('span')[0];
                                    $(errorspan).css("color", "red")
                                    $(errorspan).text(xhr.responseJSON.error)

                                    setTimeout(function() {
                                        let Cancelbutton = $(button).next(`.reportbutoncancel`)[0];
                                        $(Cancelbutton).trigger('click');
                                    }, 2000)

                                }
                            })
                        });


                        //request of block button
                        $(`.blockbutton`).click(function(e) {
                            e.preventDefault();
                            userId = $(this).attr("data-user-id");
                            let blockbutton = $(this)
                            let blockObj = {
                                "blocked_user_id": userId
                            }
                            let jsonData = JSON.stringify(blockObj);

                            $.ajax({
                                "method": "POST",
                                "url": apiUrl + "/api/Common/BlockUser?blocked_user_id=" + userId,
                                "xhrFields": {
                                    "withCredentials": true
                                },
                                "headers": {
                                    "Content-Type": "application/json",
                                    "ngrok-skip-browser-warning": "69420",
                                    "Accept-Language": language
                                },


                                success: function(data, st, xhr) {
                                    console.log(data);
                                    let buttondiv = $(blockbutton).parent()[0];
                                    let errordiv = $(buttondiv).next('div')[0]
                                    let errorspan = $(errordiv).find('span')[0];
                                    $(errorspan).css("color", "green")
                                    $(errorspan).text("User is blocked")
                                    setTimeout(function() {
                                        let Cancelbutton = $(blockbutton).next(`.blockbuttoncancel`)[0];
                                        $(Cancelbutton).trigger('click');
                                    }, 2000)

                                },
                                error: function(xhr, status, err) {
                                    if (xhr.status == 400) {
                                        let buttondiv = $(blockbutton).parent()[0];
                                        let errordiv = $(buttondiv).next('div')[0]
                                        let errorspan = $(errordiv).find('span')[0];
                                        $(errorspan).css("color", "red")
                                        $(errorspan).text(xhr.responseJSON.error)


                                    } else {
                                        let buttondiv = $(blockbutton).parent()[0];
                                        let errordiv = $(buttondiv).next('div')[0]
                                        let errorspan = $(errordiv).find('span')[0];
                                        $(errorspan).css("color", "red")
                                        $(errorspan).text("Something went wrong, please try again")

                                    }


                                }
                            })

                        });


                        $(".home-posts").append(`<div class="home-post" id="${data.postId}">
                        <div class="mb-30 post-body d-flex flex-column p-30 bg-white  rad-10">
                            <div class="post-head d-flex justify-content-between">
                                <div class="post-user-info d-flex flex-row">
                                    <div class="user-image rad-half mr-10">
                                        <img src="imgs/profilepic.svg" class = "profile${data.postId} rad-half" alt="" style="max-width: 100%;">
                                    </div>
                                    <div class="post-info d-flex flex-column">
                                        <div class="d-flex usernames align-center">
                                            <span class="fs-rem-14 fw-bold name">${data.userInfo.fullName}</span><span class="username fs-rem-12 c-grey">@${data.userInfo.username}</span></div>
                                     
                                        <span class="user-mohafza c-grey fs-rem-10">${data.governorate}</span>
                                        <div>
                                            <span class="post-time c-grey fs-rem-10 mr-px-5">${data.timeWritten}</span><span class="fs-rem-10 c-grey mr-px-5 edited">Edited at</span><span class="editedtime${data.postId} edited fs-rem-10 c-grey">8</span></div>
                                        <div class="casetype-bg p-1 txt-c w-fit case-type-rad"><span class="case-type c-white casetype-bg fs-rem-11  overflow-hidden" title = "${data.category}" >${data.category}</span></div>
                                    </div>
                                </div>
                                <div class="more-about-post d-flex flex-column align-items-end">
                                    <img src="imgs/more.svg" class="moreimg cur-point" style="width: 30px; max-width: 35px;">
                                    <ul class="p-10 dropbutton-bg mt-px-5 d-none">
                                        <li class="p-10 share-links${data.postId} share-links">Share via</li>
                                        <!-- share moadale -->

                                        <!-- Button trigger modal -->
                                        <button type="button" class="btn btn-primary d-none sharemodal " data-bs-toggle="modal" data-bs-target="#exampleModal${data.postId}">
                                                Launch demo modal
                                        </button>

                                        <!-- Modal -->
                                        <div class="modal fade" id="exampleModal${data.postId}" tabindex="-1" aria-labelledby="exampleModalLabel${data.postId}" aria-hidden="true">
                                            <div class="modal-dialog modal-dialog-centered">
                                                <div class="modal-content sharemodal-bg">
                                                    <div class="modal-header">
                                                        <h5 class="modal-title c-white" id="exampleModalLabel${data.postId}">Share</h5>
                                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                    </div>
                                                    <div class="modal-body">
                                                        <div class="social-media-icons row flex-row p-20">
                                                            <div class="col-6 col-md-3 p-0 p-1 cur-point share-icon post1" style="width: fit-content;">
                                                                <a class="whatsapp${data.postId}" target="_blank"> <img src="imgs/what's-share.svg" alt="" style="max-width: 100%;"></a>
                                                            </div>
                                                            <div class="col-6 col-md-3 p-0 p-1 cur-point  share-icon" style="width: fit-content;">
                                                                <a class="facebook-share${data.postId}" target="_blank"> <img src="imgs/facebook-share.svg" alt="" style="max-width: 100%;"></a>
                                                            </div>
                                                            <div class="col-6 col-md-3 p-0 p-1 cur-point  share-icon" style="width: fit-content;">
                                                                <a class="twitter-share${data.postId}" target="_blank" > <img src="imgs/twitter-share.svg" alt="" style="max-width: 100%;"></a>
                                                            </div>
                                                        </div>

                                                        <div class=" social-link cur-point mt-20 w-100 p-px-5 d-flex align-center justify-content-between" data-post-id ="${data.postId}">
                                                            <input class="overflow-hidden cur-point w-80 copied-link " readonly id="share-link${data.postId}"  data-post-id ="${data.postId}">
                                                            <span class="copy cur-point">Copy</span>

                                                        </div>
                                                    </div>

                                                </div>
                                            </div>
                                        </div>

                                        <li class="p-10 report">report</li>

                                        <!-- report moadale -->

                                        <!-- Button trigger modal -->
                                        <button type="button" class="btn btn-primary d-none reportmodal" data-bs-toggle="modal" data-bs-target="#exampleModal100${data.postId}">
                                            Launch demo modal
                                        </button>

                                        <!-- Modal -->
                                        <div class="modal fade" id="exampleModal100${data.postId}" tabindex="-1" aria-labelledby="exampleModalLabel100${data.postId}" aria-hidden="true">
                                            <div class="modal-dialog modal-lg">
                                                <div class="modal-content rad-20 d-flex justify-content-center align-center p-50 reportmodal-bg">

                                                    <div class="modal-body reportmodaldiv w-70 case-bg">
                                                        <div class="d-flex ">
                                                            <p>Report <span class="reporteduser c-grey">@${data.userInfo.username}â€™s post</span></p>
                                                        </div>
                                                        <div>
                                                            <form>


                                                                <div class="mb-3 w-100">

                                                                    <textarea  placeholder="The reason of report" class="form-control reportarea${data.postId}" id="exampleFormControlTextarea2${data.postId}" rows="10"></textarea>

                                                                </div>

                                                                <div class="modal-footer d-flex justify-content-evenly">
                                                                    <input type="submit" class="btn btn-primary reportbuton rad-25 p-30 shadow" data-post-id="${data.postId}">
                                                                    <button type="button" class="btn btn-secondary rad-25 reportbutoncancel shadow" data-bs-dismiss="modal">Cancel</button>
                                                                </div>
                                                                <div class = "mt-30 ">
                                                                <span class="reporterror  txt-c  fs-rem-14 d-block"></span>    
                                                                </div>

                                                                
                                                            </form>
                                                        </div>


                                                    </div>

                                                </div>
                                            </div>
                                        </div>

                                        <li class="p-10 block  lastli">block</li>
                                        <!-- block moadale -->

                                        <!-- Button trigger modal -->
                                        <button type="button" class="btn btn-primary d-none blockmodal" data-bs-toggle="modal" data-bs-target="#exampleModal1000${data.postId}">
                                            Launch demo modal
                                        </button>

                                        <!-- Modal -->
                                        <div class="modal fade" id="exampleModal1000${data.postId}" tabindex="-1" aria-labelledby="exampleModalLabel1000${data.postId}" aria-hidden="true">
                                            <div class="modal-dialog modal-dialog-centered blockmodaldiv">
                                                <div class="modal-content rad-20">

                                                    <div class="modal-body">
                                                        <p class="fw-bold txt-c">Are you sure you want to block<span class="c-grey blockedusername">@${data.userInfo.username}</span> ?</p>
                                                    </div>
                                                    <div class="modal-footer d-flex justify-content-evenly">
                                                        <button type="button" class="btn btn-primary blockbutton   rad-25 p-30 shadow " data-user-id="${data.userInfo.userId}">Yes</button>
                                                        <button type="button" class="btn btn-secondary rad-25 blockbuttoncancel shadow" data-bs-dismiss="modal">No</button>

                                                    </div>
                                                    <div class = "mt-30 mb-20">
                                                    <span class = "blockerror blockerror c-red txt-c fs-rem-14 d-block"></span>    
                                                    </div>
                                                </div>
                                            </div>
                                        </div>


                                    </ul>
                                </div>
                            </div>
                            <div class="post-text">
                                 <div class="d-flex justify-content-between mb-20 ">
                                    <h3 class="post-title">${data.title}</h3>
                                    <div class="c-white fw-bold  button-bg txt-c rad-10 d-flex justify-content-center align-center pricing hvr-bounce-in">
                                        <span class="mr-px-5">EGP</span> <span class="post-price">${data.price}</span>
                                    </div>
                                </div>
                                <p class="m-0 d-inline post-description" style="white-space: pre;text-wrap: wrap;">${data.body}</p><span class="cur-point seemore">... See more</span>
                            </div>
                            <div class="post-images post-images${data.postId}">
                                <div class=" d-flex w-100 mt-40 justify-content-center">
                                  

                                         <div id="carouselExampleControls" class="carousel slide w-100" data-bs-ride="carousel">
                                            <div class="carousel-inner images${data.postId} ">
                                              
                                               
                                            </div>
                                            <button class="carousel-control-prev carousel-control-prev${data.postId}" type="button" data-bs-target="#carouselExampleControls" data-bs-slide="prev">
                                                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                                <span class="visually-hidden">Previous</span>
                                            </button>
                                            <button class="carousel-control-next carousel-control-next${data.postId}" type="button" data-bs-target="#carouselExampleControls" data-bs-slide="next">
                                                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                                <span class="visually-hidden">Next</span>
                                            </button>
                                            </div>

                               

                                </div>

                            </div>
                            <div class="post-call mt-40">
                                <div class="w-full d-flex justify-content-between align-center">
                                    <div class="call call${data.postId}">
                                        <button type="button" class="btn btn-secondary button-bg " data-bs-toggle="tooltip" data-bs-placement="top" title="01016218389">
                                           <i class="fa-solid fa-phone-volume hvr-buzz mr-px-5"></i> <span>Call</span>
                                        </button>
                                    </div>
                                    <div class="chat">
                                        <a href = "../chat.html?id=${data.userInfo.userId}">
                                        <button type="button" class="btn btn-secondary button-bg " data-bs-placement="top">
                                           <i class="fa-regular fa-comment mr-px-5"></i> <span>Chat</span>
                                        </button>
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>`)


                        // check if there is phone or not 
                        if (data.phone == null) {
                            $(`.call${data.postId} button`).attr('disabled', 'disabled');
                        } else {
                            $(`.call${data.postId} button`).attr('title', data.phone);
                        }

                        // check if Post is edited or not
                        if (data.timeUpdated == null) {
                            $(".edited").css("display", "none");
                        } else {
                            $(`editedtime${data.postId}`).text(data.timeUpdated)
                        }

                        // check if user have profile pic or not
                        if (data.userInfo.profilePicture == null) {} else {
                            $(`.profile${data.postId}`).attr("src", `data:image/png;base64,${data.userInfo.profilePicture}`);
                        }

                        //check if user have images and display it
                        if (data.images == null || data.length == 0) {
                            $(`.images${data.postId}`).css("display", "none");
                        } else {
                            for (var i = 0; i < data.images.length; i++) {
                                let activeClass2 = i == 0 ? "active" : " ";
                                console.log(i)
                                $(`.images${data.postId}`).append(`<div class="carousel-item  ${activeClass2}">
                                                <img src="data:image/png;base64,${data.images[i]}" class="h-full w-full control-slider-img-width" alt="" style="max-width:100%; max-height:300px; height:300px">
                                                </div>`)
                            }
                        }


                        if (data.images.length == 1) {

                            $(`.carousel-control-prev${data.postId}`).addClass('d-none');
                            $(`.carousel-control-next${data.postId}`).addClass('d-none');
                        }










                        let everyPostId = $(`#share-link${data.postId}`).attr("data-post-id");
                        $(`#share-link${data.postId}`).val("http://freesmile.me/en/posts.html" + `?Id=${everyPostId}`);


                        var link = encodeURI("http://freesmile.me/en/posts.html" + `?Id=${everyPostId}`);
                        var msg = encodeURIComponent('Hey, I found this article');
                        var title = encodeURIComponent('Article or Post Title Here');

                        var fb = document.querySelector(`.facebook-share${data.postId}`);
                        fb.href = `https://www.facebook.com/share.php?u=${link}`;

                        var twitter = document.querySelector(`.twitter-share${data.postId}`);
                        twitter.href = `http://twitter.com/share?&url=${link}&text=${msg}&hashtags=javascript,programming`;

                        var whatsapp = document.querySelector(`.whatsapp${data.postId}`);
                        whatsapp.href = `https://api.whatsapp.com/send?text=${msg}: ${link}`;



                        // end of for loop






                        $(".social-link").click(function(e) {
                            let copiedinput = $(this).find('input')[0];
                            copiedinput.select();
                            document.execCommand('copy');
                            copiedinput.blur();

                        })




                        //enable tolltip of bootstrap
                        var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
                        var tooltipList = tooltipTriggerList.map(function(tooltipTriggerEl) {
                            return new bootstrap.Tooltip(tooltipTriggerEl)
                        })

                        //   facebook seemore effect 
                        var showMoreLinks = document.querySelectorAll('.seemore');
                        var maxChars = 150;
                        showMoreLinks.forEach(link => {
                            var postText = link.closest('.post-text');
                            var postDescription = postText.querySelector('.post-description');
                            var descriptionText = postDescription.textContent.trim();
                            var truncatedText = descriptionText.substring(0, maxChars).trim() + '...';
                            if (descriptionText.length <= maxChars) {
                                link.style.display = 'none';
                            } else {
                                postDescription.textContent = truncatedText;
                            }
                            link.addEventListener('click', (event) => {
                                event.preventDefault();
                                if (postDescription.textContent === truncatedText) {
                                    postDescription.textContent = descriptionText;
                                    link.textContent = 'Show less';
                                } else {
                                    postDescription.textContent = truncatedText;
                                    link.textContent = 'See more';
                                }
                            });
                        });

                        $(".moreimg").click(function() {
                            $(this).toggleClass("rotate-90");
                            $(this).next("ul").toggleClass("d-none");
                        })

                        $(`.share-links`).click(function() {
                            $(this).next(`button`).trigger("click");
                        })

                        $(`.block`).click(function() {
                            $(this).next(`button`).trigger("click");
                        })

                        $(`.report`).click(function() {
                            $(this).next(`button`).trigger("click");
                        })


                        //request of report button
                        $(`.reportbuton`).click(function(e) {
                            e.preventDefault();
                            let postId = $(this).attr("data-post-id");
                            let parentofButton = $(this).parent();
                            let perviosDiv = parentofButton.prev()[0];
                            let textarea = $(perviosDiv).find('textarea')[0];
                            let reason = $(textarea).val();

                            let button = $(this);

                            console.log(reason);
                            console.log(postId);
                            let reportObj = {
                                "reported_post_id": postId,
                                "reason": reason
                            }

                            let jsonData = JSON.stringify(reportObj);

                            if (reason.length == 0 || reason == null) {
                                delete reportObj.reason
                            }
                            $.ajax({
                                "method": "POST",
                                "url": apiUrl + "/api/Common/ReportPost",
                                "xhrFields": {
                                    "withCredentials": true
                                },
                                "headers": {
                                    "Content-Type": "application/json",
                                    "ngrok-skip-browser-warning": "69420",
                                    "Accept-Language": language
                                },
                                "data": jsonData,

                                success: function(data, st, xhr) {
                                    console.log(data);
                                    let buttondiv = $(button).parent()[0];
                                    let errordiv = $(buttondiv).next('div')[0]
                                    let errorspan = $(errordiv).find('span')[0];
                                    $(errorspan).css("color", "green")
                                    $(errorspan).text("Report Sent Sucssfully")

                                    setTimeout(function() {
                                        let Cancelbutton = $(button).next(`.reportbutoncancel`)[0];
                                        $(Cancelbutton).trigger('click');
                                    }, 2000)


                                },
                                error: function(xhr, status, err) {
                                    let buttondiv = $(button).parent()[0];
                                    let errordiv = $(buttondiv).next('div')[0]
                                    let errorspan = $(errordiv).find('span')[0];
                                    $(errorspan).css("color", "red")
                                    $(errorspan).text(xhr.responseJSON.error)

                                    setTimeout(function() {
                                        let Cancelbutton = $(button).next(`.reportbutoncancel`)[0];
                                        $(Cancelbutton).trigger('click');
                                    }, 2000)

                                }
                            })
                        });


                        //request of block button
                        $(`.blockbutton`).click(function(e) {
                            e.preventDefault();
                            userId = $(this).attr("data-user-id");
                            let blockbutton = $(this)
                            let blockObj = {
                                "blocked_user_id": userId
                            }
                            let jsonData = JSON.stringify(blockObj);

                            $.ajax({
                                "method": "POST",
                                "url": apiUrl + "/api/Common/BlockUser?blocked_user_id=" + userId,
                                "xhrFields": {
                                    "withCredentials": true
                                },
                                "headers": {
                                    "Content-Type": "application/json",
                                    "ngrok-skip-browser-warning": "69420",
                                    "Accept-Language": language
                                },


                                success: function(data, st, xhr) {
                                    console.log(data);
                                    let buttondiv = $(blockbutton).parent()[0];
                                    let errordiv = $(buttondiv).next('div')[0]
                                    let errorspan = $(errordiv).find('span')[0];
                                    $(errorspan).css("color", "green")
                                    $(errorspan).text("User is blocked")
                                    setTimeout(function() {
                                        let Cancelbutton = $(blockbutton).next(`.blockbuttoncancel`)[0];
                                        $(Cancelbutton).trigger('click');
                                    }, 2000)

                                },
                                error: function(xhr, status, err) {
                                    if (xhr.status == 400) {
                                        let buttondiv = $(blockbutton).parent()[0];
                                        let errordiv = $(buttondiv).next('div')[0]
                                        let errorspan = $(errordiv).find('span')[0];
                                        $(errorspan).css("color", "red")
                                        $(errorspan).text(xhr.responseJSON.error)


                                    } else {
                                        let buttondiv = $(blockbutton).parent()[0];
                                        let errordiv = $(buttondiv).next('div')[0]
                                        let errorspan = $(errordiv).find('span')[0];
                                        $(errorspan).css("color", "red")
                                        $(errorspan).text("Something went wrong, please try again")

                                    }


                                }
                            })

                        });


                    } else {
                        $(".social-link").click(function(e) {
                            let copiedinput = $(this).find('input')[0];
                            copiedinput.select();
                            document.execCommand('copy');
                            copiedinput.blur();

                        })
                        var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
                        var tooltipList = tooltipTriggerList.map(function(tooltipTriggerEl) {
                            return new bootstrap.Tooltip(tooltipTriggerEl)
                        })



                        //   facebook seemore effect 
                        var showMoreLinks = document.querySelectorAll('.seemore');
                        var maxChars = 150;
                        showMoreLinks.forEach(link => {
                            var postText = link.closest('.post-text');
                            var postDescription = postText.querySelector('.post-description');
                            var descriptionText = postDescription.textContent.trim();
                            var truncatedText = descriptionText.substring(0, maxChars).trim() + '...';
                            if (descriptionText.length <= maxChars) {
                                link.style.display = 'none';
                            } else {
                                postDescription.textContent = truncatedText;
                            }
                            link.addEventListener('click', (event) => {
                                event.preventDefault();
                                if (postDescription.textContent === truncatedText) {
                                    postDescription.textContent = descriptionText;
                                    link.textContent = 'Show less';
                                } else {
                                    postDescription.textContent = truncatedText;
                                    link.textContent = 'See more';
                                }
                            });
                        });

                        $(".moreimg").click(function() {
                            $(this).toggleClass("rotate-90");
                            $(this).next("ul").toggleClass("d-none");
                        })
                        $(".likes").click(function() {
                            $(".likes").toggleClass("c-green");
                        })

                        $(`.share-links`).click(function() {
                            $(this).next(`button`).trigger("click");
                        })

                        $(`.block`).click(function() {
                            $(this).next(`button`).trigger("click");
                        })

                        $(`.report`).click(function() {
                            $(this).next(`button`).trigger("click");
                        })






                        //request of report button
                        $(`.reportbuton`).click(function(e) {
                            e.preventDefault();
                            let postId = $(this).attr("data-post-id");
                            let parentofButton = $(this).parent();
                            let perviosDiv = parentofButton.prev()[0];
                            let textarea = $(perviosDiv).find('textarea')[0];
                            let reason = $(textarea).val();

                            let button = $(this);

                            console.log(reason);
                            console.log(postId);
                            let reportObj = {
                                "reported_post_id": postId,
                                "reason": reason
                            }

                            let jsonData = JSON.stringify(reportObj);

                            if (reason.length == 0 || reason == null) {
                                delete reportObj.reason
                            }
                            $.ajax({
                                "method": "POST",
                                "url": apiUrl + "/api/Common/ReportPost",
                                "xhrFields": {
                                    "withCredentials": true
                                },
                                "headers": {
                                    "Content-Type": "application/json",
                                    "ngrok-skip-browser-warning": "69420",
                                    "Accept-Language": language
                                },
                                "data": jsonData,

                                success: function(data, st, xhr) {
                                    console.log(data);
                                    let buttondiv = $(button).parent()[0];
                                    let errordiv = $(buttondiv).next('div')[0]
                                    let errorspan = $(errordiv).find('span')[0];
                                    $(errorspan).css("color", "green")
                                    $(errorspan).text("Report Sent Sucssfully")

                                    setTimeout(function() {
                                        let Cancelbutton = $(button).next(`.reportbutoncancel`)[0];
                                        $(Cancelbutton).trigger('click');
                                    }, 2000)


                                },
                                error: function(xhr, status, err) {
                                    let buttondiv = $(button).parent()[0];
                                    let errordiv = $(buttondiv).next('div')[0]
                                    let errorspan = $(errordiv).find('span')[0];
                                    $(errorspan).css("color", "red")
                                    $(errorspan).text(xhr.responseJSON.error)

                                    setTimeout(function() {
                                        let Cancelbutton = $(button).next(`.reportbutoncancel`)[0];
                                        $(Cancelbutton).trigger('click');
                                    }, 2000)

                                }
                            })
                        });


                        //request of block button
                        $(`.blockbutton`).click(function(e) {
                            e.preventDefault();
                            userId = $(this).attr("data-user-id");
                            let blockbutton = $(this)
                            let blockObj = {
                                "blocked_user_id": userId
                            }
                            let jsonData = JSON.stringify(blockObj);

                            $.ajax({
                                "method": "POST",
                                "url": apiUrl + "/api/Common/BlockUser?blocked_user_id=" + userId,
                                "xhrFields": {
                                    "withCredentials": true
                                },
                                "headers": {
                                    "Content-Type": "application/json",
                                    "ngrok-skip-browser-warning": "69420",
                                    "Accept-Language": language
                                },


                                success: function(data, st, xhr) {
                                    console.log(data);
                                    let buttondiv = $(blockbutton).parent()[0];
                                    let errordiv = $(buttondiv).next('div')[0]
                                    let errorspan = $(errordiv).find('span')[0];
                                    $(errorspan).css("color", "green")
                                    $(errorspan).text("User is blocked")
                                    setTimeout(function() {
                                        let Cancelbutton = $(blockbutton).next(`.blockbuttoncancel`)[0];
                                        $(Cancelbutton).trigger('click');
                                    }, 2000)

                                },
                                error: function(xhr, status, err) {
                                    if (xhr.status == 400) {
                                        let buttondiv = $(blockbutton).parent()[0];
                                        let errordiv = $(buttondiv).next('div')[0]
                                        let errorspan = $(errordiv).find('span')[0];
                                        $(errorspan).css("color", "red")
                                        $(errorspan).text(xhr.responseJSON.error)


                                    } else {
                                        let buttondiv = $(blockbutton).parent()[0];
                                        let errordiv = $(buttondiv).next('div')[0]
                                        let errorspan = $(errordiv).find('span')[0];
                                        $(errorspan).css("color", "red")
                                        $(errorspan).text("Something went wrong, please try again")

                                    }


                                }
                            })

                        });


                        $(".home-posts").append(`<div class="home-post" id="${data.postId}">
                        <div class="mb-30 post-body d-flex flex-column p-30 bg-white  rad-10">
                            <div class="post-head d-flex justify-content-between">
                                <div class="post-user-info d-flex flex-row">
                                    <div class="user-image rad-half mr-10">
                                        <img src="imgs/profilepic.svg" class = "profile${data.postId} rad-half" alt="" style="max-width: 100%;">
                                    </div>
                                    <div class="post-info d-flex flex-column">
                                        <div class="d-flex usernames align-center">
                                            <span class="fs-rem-14 fw-bold name">${data.userInfo.fullName}</span><span class="username fs-rem-12 c-grey">@${data.userInfo.username}</span></div>
                                     <span class="user-case fw-bold c-blue fs-rem-12">${data.dentistInfo.academicDegree}</span>
                                        <span class="user-mohafza c-grey fs-rem-10">${data.dentistInfo.university}</span>
                                        <div>
                                            <span class="post-time c-grey fs-rem-10 mr-px-5">${data.timeWritten}</span><span class="fs-rem-10 c-grey mr-px-5 edited">Edited at</span><span class="editedtime${data.postId} edited fs-rem-10 c-grey">8</span></div>
                                        <div class="casetype-bg p-1 txt-c w-fit case-type-rad"><span class="case-type c-white casetype-bg fs-rem-11  overflow-hidden" title = "${data.category}" >${data.category}</span></div>
                                    </div>
                                </div>
                                <div class="more-about-post d-flex flex-column align-items-end">
                                    <img src="imgs/more.svg" class="moreimg cur-point" style="width: 30px; max-width: 35px;">
                                    <ul class="p-10 dropbutton-bg mt-px-5 d-none">
                                        <li class="p-10 share-links${data.postId} share-links">Share via</li>
                                        <!-- share moadale -->

                                        <!-- Button trigger modal -->
                                        <button type="button" class="btn btn-primary d-none sharemodal " data-bs-toggle="modal" data-bs-target="#exampleModal${data.postId}">
                                                Launch demo modal
                                        </button>

                                        <!-- Modal -->
                                        <div class="modal fade" id="exampleModal${data.postId}" tabindex="-1" aria-labelledby="exampleModalLabel${data.postId}" aria-hidden="true">
                                            <div class="modal-dialog modal-dialog-centered">
                                                <div class="modal-content sharemodal-bg">
                                                    <div class="modal-header">
                                                        <h5 class="modal-title c-white" id="exampleModalLabel${data.postId}">Share</h5>
                                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                    </div>
                                                    <div class="modal-body">
                                                        <div class="social-media-icons row flex-row p-20">
                                                            <div class="col-6 col-md-3 p-0 p-1 cur-point share-icon post1" style="width: fit-content;">
                                                                <a class="whatsapp${data.postId}" target="_blank"> <img src="imgs/what's-share.svg" alt="" style="max-width: 100%;"></a>
                                                            </div>
                                                            <div class="col-6 col-md-3 p-0 p-1 cur-point  share-icon" style="width: fit-content;">
                                                                <a class="facebook-share${data.postId}" target="_blank"> <img src="imgs/facebook-share.svg" alt="" style="max-width: 100%;"></a>
                                                            </div>
                                                            <div class="col-6 col-md-3 p-0 p-1 cur-point  share-icon" style="width: fit-content;">
                                                                <a class="twitter-share${data.postId}" target="_blank" > <img src="imgs/twitter-share.svg" alt="" style="max-width: 100%;"></a>
                                                            </div>
                                                        </div>

                                                        <div class=" social-link cur-point mt-20 w-100 p-px-5 d-flex align-center justify-content-between" data-post-id ="${data.postId}">
                                                            <input class="overflow-hidden cur-point w-80 copied-link " readonly id="share-link${data.postId}"  data-post-id ="${data.postId}">
                                                            <span class="copy cur-point">Copy</span>

                                                        </div>
                                                    </div>

                                                </div>
                                            </div>
                                        </div>

                                        <li class="p-10 report">report</li>

                                        <!-- report moadale -->

                                        <!-- Button trigger modal -->
                                        <button type="button" class="btn btn-primary d-none reportmodal" data-bs-toggle="modal" data-bs-target="#exampleModal100${data.postId}">
                                            Launch demo modal
                                        </button>

                                        <!-- Modal -->
                                        <div class="modal fade" id="exampleModal100${data.postId}" tabindex="-1" aria-labelledby="exampleModalLabel100${data.postId}" aria-hidden="true">
                                            <div class="modal-dialog modal-lg">
                                                <div class="modal-content rad-20 d-flex justify-content-center align-center p-50 reportmodal-bg">

                                                    <div class="modal-body reportmodaldiv w-70 case-bg">
                                                        <div class="d-flex ">
                                                            <p>Report <span class="reporteduser c-grey">@${data.userInfo.username}â€™s post</span></p>
                                                        </div>
                                                        <div>
                                                            <form>


                                                                <div class="mb-3 w-100">

                                                                    <textarea  placeholder="The reason of report" class="form-control reportarea${data.postId}" id="exampleFormControlTextarea2${data.postId}" rows="10"></textarea>

                                                                </div>

                                                                <div class="modal-footer d-flex justify-content-evenly">
                                                                    <input type="submit" class="btn btn-primary reportbuton rad-25 p-30 shadow" data-post-id="${data.postId}">
                                                                    <button type="button" class="btn btn-secondary rad-25 reportbutoncancel shadow" data-bs-dismiss="modal">Cancel</button>
                                                                </div>
                                                                <div class = "mt-30 ">
                                                                <span class="reporterror  txt-c  fs-rem-14 d-block"></span>    
                                                                </div>

                                                                
                                                            </form>
                                                        </div>


                                                    </div>

                                                </div>
                                            </div>
                                        </div>

                                        <li class="p-10 block  lastli">block</li>
                                        <!-- block moadale -->

                                        <!-- Button trigger modal -->
                                        <button type="button" class="btn btn-primary d-none blockmodal" data-bs-toggle="modal" data-bs-target="#exampleModal1000${data.postId}">
                                            Launch demo modal
                                        </button>

                                        <!-- Modal -->
                                        <div class="modal fade" id="exampleModal1000${data.postId}" tabindex="-1" aria-labelledby="exampleModalLabel1000${data.postId}" aria-hidden="true">
                                            <div class="modal-dialog modal-dialog-centered blockmodaldiv">
                                                <div class="modal-content rad-20">

                                                    <div class="modal-body">
                                                        <p class="fw-bold txt-c">Are you sure you want to block<span class="c-grey blockedusername">@${data.userInfo.username}</span> ?</p>
                                                    </div>
                                                    <div class="modal-footer d-flex justify-content-evenly">
                                                        <button type="button" class="btn btn-primary blockbutton   rad-25 p-30 shadow " data-user-id="${data.userInfo.userId}">Yes</button>
                                                        <button type="button" class="btn btn-secondary rad-25 blockbuttoncancel shadow" data-bs-dismiss="modal">No</button>

                                                    </div>
                                                    <div class = "mt-30 mb-20">
                                                    <span class = "blockerror blockerror c-red txt-c fs-rem-14 d-block"></span>    
                                                    </div>
                                                </div>
                                            </div>
                                        </div>


                                    </ul>
                                </div>
                            </div>
                            <div class="post-text">
                                 <div class="d-flex justify-content-between mb-20 ">
                                    <h3 class="post-title">${data.title}</h3>
                                    
                                </div>
                                <p class="m-0 d-inline post-description" style="white-space: pre; text-wrap:wrap">${data.body}</p><span class="cur-point seemore">... See more</span>
                            </div>
                            <div class="post-images post-images${data.postId}">
                                <div class=" d-flex w-100 mt-40 justify-content-center">
                                  

                                         <div id="carouselExampleControls" class="carousel slide w-100" data-bs-ride="carousel">
                                            <div class="carousel-inner images${data.postId} ">
                                              
                                               
                                            </div>
                                            <button class="carousel-control-prev carousel-control-prev${data.postId}" type="button" data-bs-target="#carouselExampleControls" data-bs-slide="prev">
                                                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                                <span class="visually-hidden">Previous</span>
                                            </button>
                                            <button class="carousel-control-next carousel-control-next${data.postId}" type="button" data-bs-target="#carouselExampleControls" data-bs-slide="next">
                                                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                                <span class="visually-hidden">Next</span>
                                            </button>
                                            </div>

                               

                                </div>

                            </div>
                            <div class="post-call mt-40 ">
                                <div class="w-full d-flex justify-content-between align-center">
                                    <div class="likes givelike${data.postId}" data-id ="${data.postId}">
                                        <i class="fa-solid fa-hands-clapping  fs-rem-30" style="color: #0e8388;"></i><span class="numoflikes fw-bold fs-rem-25 ml-10">${data.likes}</span>
                                    </div>
                                    <a href = "post.html?Id=${data.postId}">
                                        <div class="comments">
                                        <i class="fa-regular fa-comment fa-flip-horizontal fs-rem-30" style="color: #0e8388;"></i><span class="numofcomments fw-bold fs-rem-25 ml-10">${data.comments}</span>
                                    </div>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>`)


                        // check if there is phone or not 
                        if (data.phone == null) {
                            $(`.call${data.postId} button`).attr('disabled', 'disabled');
                        } else {
                            $(`.call${data.postId} button`).attr('title', data.phone);
                        }

                        // check if Post is edited or not
                        if (data.timeUpdated == null) {
                            $(".edited").css("display", "none");
                        } else {
                            $(`editedtime${data.postId}`).text(data.timeUpdated)
                        }

                        // check if user have profile pic or not
                        if (data.userInfo.profilePicture == null) {} else {
                            $(`.profile${data.postId}`).attr("src", `data:image/png;base64,${data.userInfo.profilePicture}`);
                        }

                        //check if user have images and display it
                        if (data.images == null || data.length == 0) {
                            $(`.images${data.postId}`).css("display", "none");
                        } else {
                            for (var i = 0; i < data.images.length; i++) {
                                let activeClass2 = i == 0 ? "active" : " ";
                                console.log(i)
                                $(`.images${data.postId}`).append(`<div class="carousel-item  ${activeClass2}">
                                                <img src="data:image/png;base64,${data.images[i]}" class="h-full w-full control-slider-img-width" alt="" style="max-width:100%; max-height:300px; height:300px">
                                                </div>`)
                            }
                        }


                        if (data.images.length == 1) {

                            $(`.carousel-control-prev${data.postId}`).addClass('d-none');
                            $(`.carousel-control-next${data.postId}`).addClass('d-none');
                        }










                        let everyPostId = $(`#share-link${data.postId}`).attr("data-post-id");
                        $(`#share-link${data.postId}`).val("http://freesmile.me/en/posts.html" + `?Id=${everyPostId}`);


                        var link = encodeURI("http://freesmile.me/en/posts.html" + `?Id=${everyPostId}`);
                        var msg = encodeURIComponent('Hey, I found this article');
                        var title = encodeURIComponent('Article or Post Title Here');

                        var fb = document.querySelector(`.facebook-share${data.postId}`);
                        fb.href = `https://www.facebook.com/share.php?u=${link}`;

                        var twitter = document.querySelector(`.twitter-share${data.postId}`);
                        twitter.href = `http://twitter.com/share?&url=${link}&text=${msg}&hashtags=javascript,programming`;

                        var whatsapp = document.querySelector(`.whatsapp${data.postId}`);
                        whatsapp.href = `https://api.whatsapp.com/send?text=${msg}: ${link}`;







                        $(".likes").click(function() {
                            // $(".likes").toggleClass("c-green");

                            let PostIdforlike = $(this).attr("data-id");

                            $.ajax({
                                "method": "PUT",
                                "url": apiUrl + `/api/Dentists/LikeUnlikeArticle?articleId=${PostIdforlike}`,
                                "xhrFields": {
                                    "withCredentials": true
                                },
                                "headers": {
                                    "Content-Type": "application/json",
                                    "ngrok-skip-browser-warning": "69420",
                                    "Accept-Language": language
                                },
                                success: function(data, st, xhr) {
                                    console.log(data);
                                    console.log(PostIdforlike);

                                },
                                error: function(xhr, status, err) {
                                    console.log(xhr);
                                }
                            })





                        })


                        $(".social-link").click(function(e) {
                            let copiedinput = $(this).find('input')[0];
                            copiedinput.select();
                            document.execCommand('copy');
                            copiedinput.blur();

                        })




                        //enable tolltip of bootstrap
                        var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
                        var tooltipList = tooltipTriggerList.map(function(tooltipTriggerEl) {
                            return new bootstrap.Tooltip(tooltipTriggerEl)
                        })

                        //   facebook seemore effect 
                        var showMoreLinks = document.querySelectorAll('.seemore');
                        var maxChars = 150;
                        showMoreLinks.forEach(link => {
                            var postText = link.closest('.post-text');
                            var postDescription = postText.querySelector('.post-description');
                            var descriptionText = postDescription.textContent.trim();
                            var truncatedText = descriptionText.substring(0, maxChars).trim() + '...';
                            if (descriptionText.length <= maxChars) {
                                link.style.display = 'none';
                            } else {
                                postDescription.textContent = truncatedText;
                            }
                            link.addEventListener('click', (event) => {
                                event.preventDefault();
                                if (postDescription.textContent === truncatedText) {
                                    postDescription.textContent = descriptionText;
                                    link.textContent = 'Show less';
                                } else {
                                    postDescription.textContent = truncatedText;
                                    link.textContent = 'See more';
                                }
                            });
                        });

                        $(".moreimg").click(function() {
                            $(this).toggleClass("rotate-90");
                            $(this).next("ul").toggleClass("d-none");
                        })

                        $(`.share-links`).click(function() {
                            $(this).next(`button`).trigger("click");
                        })

                        $(`.block`).click(function() {
                            $(this).next(`button`).trigger("click");
                        })

                        $(`.report`).click(function() {
                            $(this).next(`button`).trigger("click");
                        })


                        //request of report button
                        $(`.reportbuton`).click(function(e) {
                            e.preventDefault();
                            let postId = $(this).attr("data-post-id");
                            let parentofButton = $(this).parent();
                            let perviosDiv = parentofButton.prev()[0];
                            let textarea = $(perviosDiv).find('textarea')[0];
                            let reason = $(textarea).val();

                            let button = $(this);

                            console.log(reason);
                            console.log(postId);
                            let reportObj = {
                                "reported_post_id": postId,
                                "reason": reason
                            }

                            let jsonData = JSON.stringify(reportObj);

                            if (reason.length == 0 || reason == null) {
                                delete reportObj.reason
                            }
                            $.ajax({
                                "method": "POST",
                                "url": apiUrl + "/api/Common/ReportPost",
                                "xhrFields": {
                                    "withCredentials": true
                                },
                                "headers": {
                                    "Content-Type": "application/json",
                                    "ngrok-skip-browser-warning": "69420",
                                    "Accept-Language": language
                                },
                                "data": jsonData,

                                success: function(data, st, xhr) {
                                    console.log(data);
                                    let buttondiv = $(button).parent()[0];
                                    let errordiv = $(buttondiv).next('div')[0]
                                    let errorspan = $(errordiv).find('span')[0];
                                    $(errorspan).css("color", "green")
                                    $(errorspan).text("Report Sent Sucssfully")

                                    setTimeout(function() {
                                        let Cancelbutton = $(button).next(`.reportbutoncancel`)[0];
                                        $(Cancelbutton).trigger('click');
                                    }, 2000)


                                },
                                error: function(xhr, status, err) {
                                    let buttondiv = $(button).parent()[0];
                                    let errordiv = $(buttondiv).next('div')[0]
                                    let errorspan = $(errordiv).find('span')[0];
                                    $(errorspan).css("color", "red")
                                    $(errorspan).text(xhr.responseJSON.error)

                                    setTimeout(function() {
                                        let Cancelbutton = $(button).next(`.reportbutoncancel`)[0];
                                        $(Cancelbutton).trigger('click');
                                    }, 2000)

                                }
                            })
                        });


                        //request of block button
                        $(`.blockbutton`).click(function(e) {
                            e.preventDefault();
                            userId = $(this).attr("data-user-id");
                            let blockbutton = $(this)
                            let blockObj = {
                                "blocked_user_id": userId
                            }
                            let jsonData = JSON.stringify(blockObj);

                            $.ajax({
                                "method": "POST",
                                "url": apiUrl + "/api/Common/BlockUser?blocked_user_id=" + userId,
                                "xhrFields": {
                                    "withCredentials": true
                                },
                                "headers": {
                                    "Content-Type": "application/json",
                                    "ngrok-skip-browser-warning": "69420",
                                    "Accept-Language": language
                                },


                                success: function(data, st, xhr) {
                                    console.log(data);
                                    let buttondiv = $(blockbutton).parent()[0];
                                    let errordiv = $(buttondiv).next('div')[0]
                                    let errorspan = $(errordiv).find('span')[0];
                                    $(errorspan).css("color", "green")
                                    $(errorspan).text("User is blocked")
                                    setTimeout(function() {
                                        let Cancelbutton = $(blockbutton).next(`.blockbuttoncancel`)[0];
                                        $(Cancelbutton).trigger('click');
                                    }, 2000)

                                },
                                error: function(xhr, status, err) {
                                    if (xhr.status == 400) {
                                        let buttondiv = $(blockbutton).parent()[0];
                                        let errordiv = $(buttondiv).next('div')[0]
                                        let errorspan = $(errordiv).find('span')[0];
                                        $(errorspan).css("color", "red")
                                        $(errorspan).text(xhr.responseJSON.error)


                                    } else {
                                        let buttondiv = $(blockbutton).parent()[0];
                                        let errordiv = $(buttondiv).next('div')[0]
                                        let errorspan = $(errordiv).find('span')[0];
                                        $(errorspan).css("color", "red")
                                        $(errorspan).text("Something went wrong, please try again")

                                    }


                                }
                            })

                        });

                    }
                },
                error: function(xhr, status, err) {

                }
            })



        })();
    </script>



















</body>

</html>
