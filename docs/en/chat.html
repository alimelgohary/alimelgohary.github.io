<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;500&#038;display=swap" rel="stylesheet" />

    <!-- font family -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Salsa&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/aos@3.0.0-beta.6/dist/aos.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/aos@3.0.0-beta.6/dist/aos.css" rel="stylesheet">

    <link rel="stylesheet" href="css/Normalize.css">
    <link rel="stylesheet" href="css/imagehover.min.css">
    <link rel="stylesheet" href="css/imagehover.css">
    <link rel="stylesheet" href="css/all.min.css" />
    <link rel="stylesheet" href="css/framework.css">
    <link rel="stylesheet" href="css/master.css">
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/animate.min.css">
    <link rel="stylesheet" href="css/hover.css">

    <script src="js/helper.js "></script>
    <script src="js/jquery-3.6.1.min.js "></script>

    <!-- check if loged in or not  -->
    <script>
        (async() => {
            let pageIndex = 1;
            let apiUrl = await GetServerDomain();;
            let language;
            if (window.localStorage.getItem("language") == null) {
                language = "en";
            } else {
                language = window.localStorage.getItem("language");
            }


            // check if theuser is loged in or not 
            $.ajax({
                "method": "GET",
                "url": apiUrl + "/api/Users/IsAllowedToHomeTurbo",
                "xhrFields": {
                    "withCredentials": true
                },
                "headers": {
                    "Content-Type": "application/json",
                    "ngrok-skip-browser-warning": "69420",
                    "Accept-Language": language
                },
                "data": {},
                success: function(data, st, xhr) {
                    console.log(data)
                    if (data.nextPage == "homePatient") {

                    } else if (data.nextPage == "homeDentist") {

                    } else if (data.nextPage == "homeAdmin") {

                    }
                },
                error: function(xhr, status, err) {
                    console.log(xhr);
                    window.location.href = "login.html";
                }
            })
        })();
    </script>


    <link rel="stylesheet" href="css/chat.css">
    <title>Chat</title>
    <link rel="icon" type=" image/svg+xml" href="imgs/logo.svg" />


</head>

<body style="background-color: #E9F0EF;">

    <nav class="navbar navbar-expand-lg    position-sticky fixed-top  " style="background-color: #CBE4DE;">
        <div class="container-fluid ">
            <a class="navbar-brand " href="login.html"><img style="width: 50px; height:auto" src="imgs/logo.svg" alt=""></a><span class="tittle">FreeSmile</span>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon bg-light mt-3"><i class="fa-solid fa-bars "></i></span>
            </button>
            <div class="collapse navbar-collapse " id="navbarNav">
                <ul class="navbar-nav ms-auto d-flex justify-content-between flex-row w-full col-mob">
                    <div class="d-flex justify-content-center align-center ">
                        <li class="nav-item  fs-5 ml-130">
                            <!-- make it margin right instead of left in arabic -->
                            <div class="search p-relative">
                                <span class="search-icon" id="search-icon"></span>
                                <input type="search" placeholder="Type a Word" id="search" class="p-10 ">

                            </div>
                        </li>
                    </div>
                    <div class="d-flex col-mob">
                        <li class="nav-item  fs-5 mr-10">
                            <a href="" class="nav-link active en"><span class="c-black fs-25 mr-5" id="language">EN</span><i class="fa-solid fa-globe fs-25 c-black"></i> </a>
                        </li>

                        <li class="nav-item  fs-5 d-none d-lg-block  l-border">
                            <a href="" class="nav-link active en"> </a>
                        </li>

                        <li class="nav-item  fs-5 mr-15  ">
                            <a href="" class="nav-link active en"><img src="imgs/comment.svg" style="max-width:50px; width: 30px;"></a>
                        </li>

                        <li class="nav-item  fs-5 mr-15 hvr-buzz ">
                            <a href="" class="nav-link active en notificationmark "><img src="imgs/bell.svg" style="max-width:50px; width: 30px;"> </a>

                        </li>

                        <li class="nav-item  fs-5 mr-15">
                            <a href="" class="nav-link active en"><img src="imgs/profilepic.svg" style="max-width:50px; width: 30px;"> </a>
                        </li>

                        <li class="nav-item  fs-5 mr-10 logout" id="log-out">
                            <a href="" class="nav-link active en log-out"><i class="fa-solid fa-arrow-right-from-bracket"></i> </a>
                        </li>
                    </div>
                </ul>
            </div>
        </div>
    </nav>


    <div class="container-fluid mt-30">
        <div class="w-full d-flex">

            <div class="home-chats bg-white rad-10">
                <div class="chat-content d-flex flex-column w-100 p-10">
                    <div class="chat-header d-flex justify-content-between mb-10">
                        <div>
                            <span class="fw-bold fs-rem-20">Chats</span>
                        </div>

                    </div>
                    <div class="w-full d-flex justify-content-start mb-10">
                        <div class="search  p-relative w-80">
                            <span class="search-icon " id="search-icon2"></span>
                            <span class="remove-search">x</span>
                            <input type="search" placeholder="Type a Word" id="search2" class="p-10 ">

                        </div>
                    </div>
                    <div class="chat-users mt-20 w-full d-flex flex-column">
                        <ul class=" w-full chat-users-ul">

                        </ul>
                        <div class="progress loadingchats d-none">
                            <div class="progress-bar progress-bar-striped progress-bar-animated bg-secondary" role="progressbar" aria-valuenow="75" aria-valuemin="0" aria-valuemax="100" style="width: 100%"></div>
                        </div>

                    </div>
                </div>
            </div>


            <div class="home-content ">


                <div class="home-posts h-100  ml-10">

                    <div class="chat-body-header w-full d-flex justify-content-between">
                        <div class="chat-head-info cur-point">
                            <a href="">
                                <img src="imgs/profilepic.svg" class="rad-half mr-px-5" style="width: 50px; height: 50px;">
                                <span class="chated-person-name c-black fw-bold fs-rem-15 "></span>
                            </a>
                        </div>
                        <div class="chat-call d-flex flex-column p-relative mr-10 " style="width: 25px;">
                            <img src="imgs/callinfo.svg" alt="" class="cur-point w-full more-chat" style="max-width: 25px;">
                            <ul class="info-ul d-none">
                                <li class="clear-chat cur-point mt-10 ">Clear</li>

                                <li class="report-chat cur-point mt-10 ">Report</li>

                                <li class="block-chat cur-point mt-10">Block</li>
                            </ul>

                        </div>
                    </div>


                    <div class="chat-body-messages ">


                        <!-- make ul has all width and put dives inside li and make float left  -->
                        <ul class="w-full p-0 m-0 d-flex flex-column chat-ul">

                            <li class="message-skeleton d-none"></li>
                        </ul>



                    </div>

                    <div class="chat-footer d-flex w-full justify-content-center align-center">
                        <input type="text" class="chat-message-input mr-10 rad-10 mt-px-5 " placeholder="Write here to send message..." autofocus>
                        <img src="imgs/send.svg" alt="" class="message-send mt-px-5 cur-point " style="width: 40px;">
                        <div class="spinner-border text-info ml-10 d-none" role="status">

                        </div>
                    </div>

                </div>
            </div>




        </div>

    </div>













    <div class="nav-bg d-none notification-content rad-10 " style="width: 350px; height: 450px; ">
        <p class="fs-25 fw-bold p-10 mb-20 ">Notifications</p>
        <ul class="w-full notification-ul">


        </ul>

    </div>



    <!-- add case modal -->

    <!-- Button trigger modal -->
    <button type="button " class="btn btn-primary modal2-button d-none " data-bs-toggle="modal " data-bs-target="#exampleModal ">
  Launch demo modal
</button>

    <!-- Modal -->
    <div class="modal fade " id="exampleModal " tabindex="-1 " aria-labelledby="exampleModalLabel " aria-hidden="true ">
        <div class="modal-dialog modal-lg ">
            <div class="modal-content dropbutton-bg ">
                <div class="modal-header ">

                    <button type="button " class="btn-close " data-bs-dismiss="modal " aria-label="Close "></button>
                </div>
                <div class="modal-body ">
                    <div class="modalbody ">

                        <div class="choosecase d-flex justify-content-evenly ">
                            <div>
                                <input type="radio " id="Requestapatient " value="requestapatient " name="case "><label for="Requestapatient " id="requestapatient " class="ml-10 fw-bold ">Request a patient</label>
                            </div>
                            <div>
                                <input type="radio " id="Sharecase " value="sharecase " name="case "><label for="Sharecase " id="sharecase " class="ml-10 fw-bold ">Share case with other dentists</label>
                            </div>
                        </div>

                        <div class="Requestapatient ">
                            <div class="sendcase w-full d-flex justify-content-center mt-30 ">
                                <form class="bg-white w-80 d-flex flex-column p-30 mb-60 ">
                                    <div class="img-of-case ">
                                        <img src="imgs/addcase.svg " alt=" " style="width: 40px; "><span id="addcase " class="fw-bold fs-15 ml-10 ">Add Case</span>
                                    </div>


                                    <div class="d-flex justify-content-center mt-80 ">
                                        <div class="mb-3 w-90 Casetitle ">
                                            <label for="formGroupExampleInput " class="form-label fw-bold fs-20 ">Title*</label>
                                            <input type="text " class="form-control casetitle " required id="formGroupExampleInput " placeholder="Enter title ">
                                        </div>
                                    </div>
                                    <span class="titleerror c-red fs-14 ml-20 "> </span>
                                    <div class="w-90 d-flex justify-content-between align-center ">
                                        <div class="w-40 mt-30 p-20 casetype loction ">
                                            <p class="fw-bold fs-15 ">Location*</p>
                                            <input required list="locations " placeholder="Search for location " id="location " name="location " class="w-full p-10 form-control ">
                                            <datalist id="locations ">
                                                    <option value="location1 ">location1</option>
                                                    <option value="location2 ">location2</option>
                                                    <option value="location3 ">location3</option>
                                                </datalist>

                                        </div>

                                        <div class="w-40 mt-30 p-20 casetype ">
                                            <p class="fw-bold fs-15 ">Case type*</p>
                                            <input required list="casetypes " placeholder="Search for type " id="casetype " name="casetype " class="w-full p-10 form-control ">
                                            <datalist id="casetypes ">
                                                    <option value="case1 ">case1</option>
                                                    <option value="case2 ">case2</option>
                                                    <option value="case3 ">case3</option>
                                                </datalist>

                                        </div>
                                    </div>
                                    <div class="d-flex justify-content-evenly ">
                                        <span class="casetypeerror c-red fs-14 ml-20 "> </span>
                                        <span class="locationerror c-red fs-14 ml-20 "> </span>
                                    </div>

                                    <div class="discriptioncase w-full mt-30 d-flex justify-content-center ">
                                        <div class="mb-3 w-90 ">
                                            <label for="exampleFormControlTextarea1 " class="form-label fw-bold fs-20 ">Description*</label>
                                            <textarea required placeholder="Enter description " class="form-control " id="exampleFormControlTextarea1 " rows="5 "></textarea>
                                        </div>
                                    </div>

                                    <div class=" w-full mt-30 d-flex justify-content-center mb-60 cur-point ">
                                        <div class="w-90 ">
                                            <label for="exampleFormControlTextarea1 " class="form-label fw-bold fs-20 ">Add photo / videos <span class="c-grey fs-15 ">(optional)</span></label>
                                            <div class="caseimages image-preview w-full rad-10 d-flex justify-content-center align-center " style="height: 200px; ">
                                                <div class=" d-flex flex-column justify-content-center align-center selectcaseimages ">
                                                    <img src="imgs/uploadimage.svg " style="width: 30px; ">
                                                    <span>Click here to add or to readd</span>
                                                </div>
                                            </div>
                                            <p class="c-grey fs-14 mt-10 ">(hint: you can't delete choossen image if you want to delete, chosoe from first again)</p>
                                        </div>

                                    </div>

                                    <div class="modal-footer w-full d-flex justify-content-evenly ">
                                        <button type="button " class="btn btn-secondary " data-bs-dismiss="modal ">Cancel</button>
                                        <input type="submit " value="Add " class="btn btn-primary sendcasebutton ">
                                        <input type="file " class="selectcaseimage d-none " multiple onchange="displayImages(this) ">
                                    </div>
                                </form>
                            </div>
                        </div>


                    </div>
                </div>

            </div>
        </div>
    </div>


    <!-- log out modal  -->

    <!-- Button trigger modal -->
    <button type="button " class="btn btn-primary logoutbutton d-none " data-bs-toggle="modal" data-bs-target="#exampleModal10">
                        Launch demo modal
                        </button>

    <!-- Modal -->
    <div class="modal fade " id="exampleModal10" tabindex="-1 " aria-labelledby="exampleModal10" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered logoutmodal">
            <div class="modal-content rad-10 ">
                <div class="modal-header ">

                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body d-flex justify-content-center ">
                    <p class="fs-20 c-red fw-bold txt-c ">Are you sure you want to log out ?</p>
                </div>
                <div class="modal-footer d-flex w-full justify-content-around mb-25 ">
                    <button type="button" class="btn btn-secondary p-10 hvr-float-shadow" data-bs-dismiss="modal">No</button>
                    <button type="button" class="btn btn-primary bg-danger logoutreq p-10 hvr-float-shadow">Yes</button>

                </div>
                <div class="d-flex justify-content-center mt-10 mb-20 ">
                    <span class="txt-c logouterror c-red ">Some thing went wrong ,please try again later</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Clear modal  -->

    <!-- Button trigger modal -->
    <button type="button " class="btn btn-primary clearbutton d-none " data-bs-toggle="modal" data-bs-target="#exampleModal11">
                        Launch demo modal
                        </button>

    <!-- Modal -->
    <div class="modal fade " id="exampleModal11" tabindex="-1" aria-labelledby="exampleModal11" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered logoutmodal">
            <div class="modal-content rad-10 ">
                <div class="modal-header ">

                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body d-flex justify-content-center ">
                    <p class="fs-20 c-red fw-bold txt-c ">Are you sure you want to clear the chat ?</p>
                </div>
                <div class="modal-footer d-flex w-full justify-content-around mb-25 ">
                    <button type="button" class="btn btn-secondary p-10 hvr-float-shadow" data-bs-dismiss="modal">No</button>
                    <button type="button" class="btn btn-primary bg-danger clearreq p-10 hvr-float-shadow">Yes</button>

                </div>
                <div class="d-flex justify-content-center mt-10 mb-20 ">
                    <span class="txt-c logouterror c-red ">Some thing went wrong ,please try again later</span>
                </div>
            </div>
        </div>
    </div>

    <!-- report modal  -->

    <!-- Button trigger modal -->
    <button type="button " class="btn btn-primary reportbuton d-none " data-bs-toggle="modal" data-bs-target="#exampleModal12">
                        Launch demo modal
                        </button>

    <!-- Modal -->
    <div class="modal fade " id="exampleModal12" tabindex="-1 " aria-labelledby="exampleModal12" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered logoutmodal">
            <div class="modal-content rad-10 ">
                <div class="modal-header ">

                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body d-flex justify-content-center ">
                    <p class="fs-20 c-black fw-bold txt-c ">Are you sure you want to report<span class="user-name c-grey"></span></p>
                </div>
                <div class="modal-footer d-flex w-full justify-content-around mb-25 ">
                    <button type="button" class="btn btn-secondary p-10 hvr-float-shadow" data-bs-dismiss="modal">No</button>
                    <button type="button" class="btn btn-primary bg-danger reportreq p-10 hvr-float-shadow">Yes</button>

                </div>
                <div class="d-flex justify-content-center mt-10 mb-20 ">
                    <span class="txt-c logouterror c-red ">Some thing went wrong ,please try again later</span>
                </div>
            </div>
        </div>
    </div>


    <!-- block modal  -->

    <!-- Button trigger modal -->
    <button type="button " class="btn btn-primary blockbutton2 d-none " data-bs-toggle="modal" data-bs-target="#exampleModal13">
                        Launch demo modal
                        </button>

    <!-- Modal -->
    <div class="modal fade" id="exampleModal13" tabindex="-1" aria-labelledby="exampleModal13" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered logoutmodal">
            <div class="modal-content rad-10">
                <div class="modal-header">

                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body d-flex justify-content-center">
                    <p class="fs-20 c-black fw-bold txt-c ">Are you sure you want to block<span class="user-name c-grey"></span></p>
                </div>
                <div class="modal-footer d-flex w-full justify-content-around mb-25 ">
                    <button type="button" class="btn btn-secondary p-10 hvr-float-shadow blockbuttoncancel" data-bs-dismiss="modal">No</button>
                    <button type="button" class="btn btn-primary bg-danger blockreq p-10 hvr-float-shadow">Yes</button>

                </div>
                <div class="d-flex justify-content-center mt-10 mb-20 ">
                    <span class="txt-c blockerror2 c-red "></span>
                </div>
            </div>
        </div>
    </div>







    <script src="js/bootstrap.bundle.min.js "></script>
    <script src="js/all.min.js "></script>
    <script src="js/popper.min.js "></script>
    <script src="js/chat.js "></script>

    <script>
        var searchBool = false;
        var recentIdMessage;
        var getChtedMessae = false;
        $("#search").keypress(function(event) {
            if ((event.key).toLowerCase() == "enter") {
                window.location.href = "search.html";
            }
        })

        $('#search-icon').on('click', function() {
            window.location.href = "search.html";
        });
        $(".chat-mess").click(function() {
            $(this).next(".mesagetime").toggleClass("d-none")
        })
        $(".more-chat").click(function() {
            $(".info-ul").toggleClass("d-none");
        })
        $(".clear-chat").click(function() {
            $(".clearbutton").trigger("click")
        })
        $(".report-chat").click(function() {
            $(".reportbuton").trigger("click")
        })
        $(".block-chat").click(function() {
            $(".blockbutton2").trigger("click")
        })
        $("#search2").focus(function() {
            $(".remove-search").css("opacity", "0");
        })
        $("#search2").blur(function() {
            $(".remove-search").css("opacity", "1");
        })



        $(document).on('click', function(event) {
            var infoUl = $('.info-ul');
            var moreChat = $('.more-chat');

            if (!$(event.target).hasClass('more-chat') && !infoUl.hasClass('d-none')) {
                infoUl.addClass('d-none');
            }
        });
    </script>

    <!-- log out  -->
    <script>
        (async() => {
            let apiUrl = await GetServerDomain();
            let language;
            if (window.localStorage.getItem("language") == null) {
                language = "en";
            } else {
                language = window.localStorage.getItem("language");
            }


            $("#log-out").click(function() {
                $(".logoutbutton").trigger("click");
                console.log("hello")
            })

            $(".logoutreq").click(function() {
                console.log("logedout")
                $.ajax({
                    "method": "GET",
                    "url": apiUrl + "/api/Users/Logout",
                    "xhrFields": {
                        "withCredentials": true
                    },
                    "headers": {
                        "Content-Type": "application/json",
                        "ngrok-skip-browser-warning": "69420",
                        "Accept-Language": language
                    },
                    success: function(data, st, xhr) {
                        console.log(data);
                        window.location.href = "login.html"
                    },
                    error: function(xhr, status, err) {
                        $(".logouterror").css("display", "block");
                    }
                })




            })
        })();
    </script>

    <script>
        $("a.nav-link").click(function(e) {
            e.preventDefault();
        })

        $(".notificationmark").click(function() {
            $(".notification-content").toggleClass("d-none");
        })


        $(".logout").click(function() {
            $(".logoutbutton ").trigger("click ");

        })
    </script>

    <!-- get user info  -->

    <script>
        (async() => {
            let apiUrl = await GetServerDomain();
            var lastMassegeId;
            let pageIndex = 2;
            let url = window.location.href
            url = url.split("?")
            let userId = url[1].split("=")
            userId = userId[1]

            var firstMassegeId;



            // make request to get user info
            $.ajax({
                "method": "GET",
                "url": `${apiUrl}/api/Users/GetBasicUserInfo?Id=${userId}`,
                "xhrFields": {
                    "withCredentials": true
                },
                "headers": {
                    "Content-Type": "application/json",
                    "ngrok-skip-browser-warning": "69420",
                    "Accept-Language": language
                },

                success: function(data, st, xhr) {
                    console.log(data);
                    let newRole = data.role.toLowerCase();
                    let imageSrc;
                    if (data.profilePicture == null) {
                        imageSrc = "imgs/profilepic.svg"
                    } else {
                        imageSrc = "data:image/png;base64," + data.profilePicture
                    }
                    $(".chat-head-info img").attr("src", imageSrc);
                    $(".chated-person-name").text(data.fullName)
                    $(".chat-head-info a").attr("href", `${newRole}/profile.html?id=${userId}`)
                    $(".user-name").text("@" + data.username)

                },
                error: function(xhr, status, err) {

                }
            })








        })();
    </script>



    <!-- get chat messages  -->
    <script>
        (async() => {
            let apiUrl = await GetServerDomain();
            var lastMassegeId;
            let pageIndex = 2;
            let url = window.location.href
            url = url.split("?")
            let userId = url[1].split("=")
            userId = userId[1]

            var firstMassegeId;



            // make request to get chat messages when page load
            $.ajax({
                "method": "GET",
                "url": `${apiUrl}/api/Common/GetChatHistory?receiver_user_id=${userId}&Page=1&Size=10`,
                "xhrFields": {
                    "withCredentials": true
                },
                "headers": {
                    "Content-Type": "application/json",
                    "ngrok-skip-browser-warning": "69420",
                    "Accept-Language": language
                },
                beforeSend: function() {
                    $(".message-skeleton").removeClass("d-none")
                },
                success: function(data, st, xhr) {
                    $(".message-skeleton").addClass("d-none")
                    if (data.length > 0) {

                        getChtedMessae = true;
                        console.log(data)

                        lastMassegeId = data[data.length - 1].messageId
                        recentIdMessage = data[0].messageId
                        console.log(recentIdMessage)
                        console.log(getChtedMessae)
                        for (var i = 0; i < data.length; i++) {
                            if (data[i].isSender == true) {
                                $(".chat-ul").prepend(`<li class="w-full c-white mb-10 be-end ">
                                <div class="d-flex fs-rem-14 l-1-2 personal-message mr-px-5 ">
                                    <div class="w-fit rad-10 bg-white p-10 button-bg chat-mess">
                                        <span class="chated-message cur-point" id ="${data[i].messageId}">${data[i].message} </span>
                                    </div>
                                    <div class="d-flex mesagetime align-items-end d-none">
                                        <span class=" c-grey fs-rem-12">${data[i].sentAt}</span>
                                    </div>

                                </div>
                            </li>`)
                            } else {
                                $(".chat-ul").prepend(`   <li class="mb-10 w-full">
                                <div class="chated-person-info w-60 d-flex fs-rem-14 l-1-2">
                                    <div style="width: 35px;" class="mr-10">
                                        <img src="imgs/profilepic.svg" alt="" class="rad-half" style="max-width: 100%;">
                                    </div>
                                    <div class="w-fit rad-10 bg-white p-10 d-flex flex-column chat-mess">
                                        <span class="chated-message cur-point" id ="${data[i].messageId}">${data[i].message}  </span>
                                    </div>
                                    <div class="d-flex mesagetime align-items-end d-none">
                                        <span class=" c-grey fs-rem-12">${data[i].sentAt}</span>
                                    </div>
                                </div>

                            </li>`)
                            }
                        }

                        $(".chat-mess").click(function() {
                            $(this).next(".mesagetime").toggleClass("d-none")
                        })


                        $(document).ready(function() {
                            $('.chat-body-messages').scrollTop($('.chat-body-messages')[0].scrollHeight);
                        });
                    }
                },
                error: function(xhr, status, err) {
                    if (userId == 0) {
                        $(".home-posts").addClass("d-none")
                        $(".chat-body-messages").addClass("d-none")
                    }
                }
            })


            // make request to get chat messages when scroll top
            $(document).ready(function() {

                $('.chat-body-messages').scrollTop($('.chat-body-messages')[0].scrollHeight);

                $('.chat-body-messages').on('scroll', function() {
                    if ($(this).scrollTop() === 0) {
                        let messgeid2 = lastMassegeId;

                        $.ajax({
                            "method": "GET",
                            "url": `${apiUrl}/api/Common/GetChatHistory?receiver_user_id=${userId}&Page=${pageIndex}&Size=10`,
                            "xhrFields": {
                                "withCredentials": true
                            },
                            "headers": {
                                "Content-Type": "application/json",
                                "ngrok-skip-browser-warning": "69420",
                                "Accept-Language": language
                            },
                            beforeSend: function() {

                                $(".chat-ul").prepend(`<li class="message-skeleton "></li>`)
                            },
                            success: function(data, st, xhr) {
                                $(".message-skeleton").addClass("d-none")
                                $(".chat-mess").click(function() {
                                    $(this).next(".mesagetime").toggleClass("d-none")
                                })
                                console.log(data)

                                console.log(messgeid2)
                                console.log(pageIndex)
                                if (data.length == 0) {
                                    console.log("engh")
                                } else {
                                    messgeid2 = data[data.length - 1].messageId

                                    for (var i = 0; i < data.length; i++) {

                                        if (data[i].isSender == true) {
                                            $(".chat-ul").prepend(`<li class="w-full c-white mb-10 be-end ">
                                <div class="d-flex fs-rem-14 l-1-2 personal-message mr-px-5 ">
                                    <div class="w-fit rad-10 bg-white p-10 button-bg chat-mess">
                                        <span class="chated-message cur-point" id ="${data[i].messageId}">${data[i].message} </span>
                                    </div>
                                    <div class="d-flex mesagetime align-items-end d-none">
                                        <span class=" c-grey fs-rem-12">${data[i].sentAt}</span>
                                    </div>

                                </div>
                            </li>`)
                                        } else {
                                            $(".chat-ul").prepend(`   <li class="mb-10 w-full">
                                <div class="chated-person-info w-60 d-flex fs-rem-14 l-1-2">
                                    <div style="width: 35px;" class="mr-10">
                                        <img src="imgs/profilepic.svg" alt="" class="rad-half" style="max-width: 100%;">
                                    </div>
                                    <div class="w-fit rad-10 bg-white p-10 d-flex flex-column chat-mess">
                                        <span class="chated-message cur-point" id ="${data[i].messageId}">${data[i].message}  </span>
                                    </div>
                                    <div class="d-flex mesagetime align-items-end d-none">
                                        <span class=" c-grey fs-rem-12">${data[i].sentAt}</span>
                                    </div>
                                </div>

                            </li>`)
                                        }
                                    }
                                    pageIndex++;
                                }

                                $(".chat-mess").click(function() {
                                    $(this).next(".mesagetime").toggleClass("d-none")
                                })

                            },
                            error: function(xhr, status, err) {
                                if (userId == 0) {
                                    $(".home-posts").addClass("d-none")
                                    $(".chat-body-messages").addClass("d-none")
                                }
                            }
                        })


                    }
                });
            });




            // make request every 5 seconds to get new messages
            setInterval(() => {

                $.ajax({
                    "method": "GET",
                    "url": `${apiUrl}/api/Common/GetChatHistory?receiver_user_id=${userId}&Page=1&Size=64&after=${recentIdMessage}`,
                    "xhrFields": {
                        "withCredentials": true
                    },
                    "headers": {
                        "Content-Type": "application/json",
                        "ngrok-skip-browser-warning": "69420",
                        "Accept-Language": language
                    },
                    beforeSend: function() {

                    },
                    success: function(data, st, xhr) {
                        if (!(data.length == 0)) {

                            console.log(data)

                            $(".chat-mess").click(function() {
                                $(this).next(".mesagetime").toggleClass("d-none")
                            })

                            console.log(lastMassegeId)
                            console.log("out of for")
                            for (var i = 0; i < data.length; i++) {
                                recentIdMessage = data[0].messageId
                                console.log(" in for")
                                if (data[i].isSender == true) {
                                    $(".chat-ul").append(`<li class="w-full c-white mb-10 be-end ">
                                <div class="d-flex fs-rem-14 l-1-2 personal-message mr-px-5 ">
                                    <div class="w-fit rad-10 bg-white p-10 button-bg chat-mess">
                                        <span class="chated-message cur-point" id ="${data[i].messageId}">${data[i].message} </span>
                                    </div>
                                    <div class="d-flex mesagetime align-items-end d-none">
                                        <span class=" c-grey fs-rem-12">${data[i].sentAt}</span>
                                    </div>

                                </div>
                            </li>`)
                                } else {
                                    $(".chat-ul").append(`   <li class="mb-10 w-full">
                                <div class="chated-person-info w-60 d-flex fs-rem-14 l-1-2">
                                    <div style="width: 35px;" class="mr-10">
                                        <img src="imgs/profilepic.svg" alt="" class="rad-half" style="max-width: 100%;">
                                    </div>
                                    <div class="w-fit rad-10 bg-white p-10 d-flex flex-column chat-mess">
                                        <span class="chated-message cur-point" id ="${data[i].messageId}">${data[i].message}  </span>
                                    </div>
                                    <div class="d-flex mesagetime align-items-end d-none">
                                        <span class=" c-grey fs-rem-12">${data[i].sentAt}</span>
                                    </div>
                                </div>

                            </li>`)
                                }
                            }

                            $(".chat-mess").click(function() {
                                $(this).next(".mesagetime").toggleClass("d-none")
                            })


                            $(document).ready(function() {
                                $('.chat-body-messages').scrollTop($('.chat-body-messages')[0].scrollHeight);
                            });

                        }
                    },
                    error: function(xhr, status, err) {
                        if (userId == 0) {
                            $(".home-posts").addClass("d-none")
                            $(".chat-body-messages").addClass("d-none")
                        }
                    }
                })


            }, 5000);


        })();
    </script>

    <!-- get chated people  -->
    <script>
        (async() => {
            let apiUrl = await GetServerDomain();
            var lastMassegeId;
            let pageIndex = 2;
            let url = window.location.href
            url = url.split("?")
            let userId = url[1].split("=")
            userId = userId[1]

            var firstMassegeId;


            $.ajax({
                "method": "GET",
                "url": `${apiUrl}/api/Common/GetRecentMessages?Page=1&Size=4`,
                "xhrFields": {
                    "withCredentials": true
                },
                "headers": {
                    "Content-Type": "application/json",
                    "ngrok-skip-browser-warning": "69420",
                    "Accept-Language": language
                },
                beforeSend: function() {

                },
                success: function(data, st, xhr) {
                    console.log(data);
                    for (var i = 0; i < data.length; i++) {
                        let profilesrc;
                        if (data[i].profilePicture == null) {
                            profilesrc = "imgs/profilepic.svg"
                        } else {
                            profilesrc = "data:image/png;base64," + data[i].profilePicture;
                        }
                        $(".chat-users-ul").append(` <a href="?id=${data[i].userId}">  <li class="cur-point mb-20 p-px-5 d-flex flex-row align-center">
                            
                                <div>
                                    <img src=${profilesrc} alt="" style="width: 30px; height:30px;" class="user-photo mr-px-5 d-none rad-half d-lg-inline">
                                </div>
                                <div class="d-flex flex-column chat-user-text">
                                    <span class="chat-user fw-bold">${data[i].fullName}</span>
                                    <div class="d-flex c-grey fs-rem-12 ">
                                        <span class="mr-px-5 chat-tetx c-black">${data[i].lastMessage}</span>
                                        <span class="chat-time">${data[i].lastMessageTime}</span>
                                    </div>
                                </div>
                              
                            </li>  </a>`)

                    }

                },
                error: function(xhr, status, err) {

                }
            })



            let notRemanningPeople = 0
            let pageIndex2, pageIndex3 = 2;

            // gwr serach  poeple when scroll 
            $('.home-chats').scroll(function() {

                let notRemanningPeople2 = 0;
                var element = $(this);
                if (element.scrollTop() + element.innerHeight() >= element[0].scrollHeight) {
                    let seachValue = $("#search2").val();
                    if (searchBool) {
                        $.ajax({
                            "method": "GET",
                            "url": `${apiUrl}/api/Common/GetRecentMessages?Page=${pageIndex3}&Size=6&q=${seachValue}`,
                            "xhrFields": {
                                "withCredentials": true
                            },
                            "headers": {
                                "Content-Type": "application/json",
                                "ngrok-skip-browser-warning": "69420",
                                "Accept-Language": language
                            },
                            beforeSend: function() {
                                if (notRemanningPeople2 == 0) {
                                    $(".loadingchats").removeClass("d-none")
                                }
                            },
                            success: function(data, st, xhr) {
                                console.log(data);
                                if (data.length == 0 && notRemanningPeople2 == 0) {
                                    $(".chat-users-ul").append(`<h4 class = "fs-15 c-grey mt-10 mb-10">No remaining people</h4>`);
                                    notRemanningPeople2 = 1;
                                } else {

                                    for (var i = 0; i < data.length; i++) {

                                        let profilesrc;
                                        if (data[i].profilePicture == null) {
                                            profilesrc = "imgs/profilepic.svg"
                                        } else {
                                            profilesrc = "data:image/png;base64," + data[i].profilePicture;
                                        }
                                        $(".chat-users-ul").append(` <a href="?id=${data[i].userId}">  <li class="cur-point mb-20 p-px-5 d-flex flex-row">
                            
                                <div>
                                    <img src=${profilesrc} alt="" style="max-width: 30px; max-height:30px;" class="user-photo mr-px-5 d-none rad-half d-lg-inline">
                                </div>
                                <div class="d-flex flex-column chat-user-text">
                                    <span class="chat-user fw-bold">${data[i].fullName}</span>
                                    <div class="d-flex c-grey fs-rem-12 message-contain${data[i].userId}">
                                        <span class="mr-px-5 chat-tetx c-black">${data[i].lastMessage}</span>
                                        <span class="chat-time">${data[i].lastMessageTime}</span>
                                    </div>
                                </div>
                              
                            </li>  </a>`)

                                        if (data[i].lastMessage == null) {
                                            $(`.message-contain${data[i].userId}`).addClass("d-none");
                                        }
                                    }

                                }
                                pageIndex3++;
                            },
                            error: function(xhr, status, err) {

                            }
                        })


                    }
                }
            });




            // make requsr when send message 
            $(".message-send").click(function() {

                let messageFromInput = $(".chat-message-input").val();
                let ajaxObj = {
                    "receiver_Id": userId,
                    "message": messageFromInput
                }
                let jsonOBJ = JSON.stringify(ajaxObj);
                $.ajax({
                    "method": "POST",
                    "url": `${apiUrl}/api/Common/SendMessage`,
                    "xhrFields": {
                        "withCredentials": true
                    },
                    "headers": {
                        "Content-Type": "application/json",
                        "ngrok-skip-browser-warning": "69420"

                    },
                    "data": jsonOBJ,
                    beforeSend: function() {

                        $(".spinner-border").removeClass("d-none")

                    },
                    success: function(data, st, xhr) {
                        recentIdMessage = data.messageId
                        $(".spinner-border").addClass("d-none")
                        $(".chat-mess").click(function() {
                            $(this).next(".mesagetime").toggleClass("d-none")
                        })

                        console.log(data)
                        $(".chat-ul").append(`<li class="w-full c-white mb-10 be-end ">
                                <div class="d-flex fs-rem-14 l-1-2 personal-message mr-px-5 ">
                                    <div class="w-fit rad-10 bg-white p-10 button-bg chat-mess">
                                        <span class="chated-message cur-point" id ="${data.messageId}">${data.message} </span>
                                    </div>
                                    <div class="d-flex mesagetime align-items-end d-none">
                                        <span class=" c-grey fs-rem-12">${data.sentAt}</span>
                                    </div>

                                </div>
                            </li>`)
                        $(".chat-message-input").val("");
                        $(document).ready(function() {
                            $('.chat-body-messages').scrollTop($('.chat-body-messages')[0].scrollHeight);
                        });
                        $(".chat-mess").click(function() {
                            $(this).next(".mesagetime").toggleClass("d-none")
                        })

                    },
                    error: function(xhr, status, err) {
                        $(".spinner-border").addClass("d-none")

                        $(".chat-mess").click(function() {
                            $(this).next(".mesagetime").toggleClass("d-none")
                        })
                        console.log(xhr)
                        $(".chat-ul").append(`<li class="w-full c-white mb-10 be-end ">
                                <div class="d-flex fs-rem-14 l-1-2 personal-message mr-px-5 ">
                                    <div class="w-fit rad-10 bg-white p-10 button-bg chat-mess">
                                        <span class="chated-message cur-point" id =""> ${messageFromInput}</span>
                                    </div>
                                    <div class="d-flex mesagetime align-items-end ">
                                        <span class=" c-grey fs-rem-12 c-red">Failed</span>
                                    </div>

                                </div>
                            </li>`)
                        $(".chat-message-input").val("");
                        $(document).ready(function() {
                            $('.chat-body-messages').scrollTop($('.chat-body-messages')[0].scrollHeight);
                        });
                        $(".chat-mess").click(function() {
                            $(this).next(".mesagetime").toggleClass("d-none")
                        })
                    }
                })

            })




            $(".chat-message-input").keypress(function(e) {

                if (e.key.toLowerCase() == "enter") {

                    let messageFromInput = $(".chat-message-input").val();
                    let ajaxObj = {
                        "receiver_Id": userId,
                        "message": messageFromInput
                    }
                    let jsonOBJ = JSON.stringify(ajaxObj);
                    $.ajax({
                        "method": "POST",
                        "url": `${apiUrl}/api/Common/SendMessage`,
                        "xhrFields": {
                            "withCredentials": true
                        },
                        "headers": {
                            "Content-Type": "application/json",
                            "ngrok-skip-browser-warning": "69420"

                        },
                        "data": jsonOBJ,
                        beforeSend: function() {

                            $(".spinner-border").removeClass("d-none")

                        },
                        success: function(data, st, xhr) {
                            recentIdMessage = data.messageId
                            $(".spinner-border").addClass("d-none")
                            $(".chat-mess").click(function() {
                                $(this).next(".mesagetime").toggleClass("d-none")
                            })

                            console.log(data)
                            $(".chat-ul").append(`<li class="w-full c-white mb-10 be-end ">
                                <div class="d-flex fs-rem-14 l-1-2 personal-message mr-px-5 ">
                                    <div class="w-fit rad-10 bg-white p-10 button-bg chat-mess">
                                        <span class="chated-message cur-point" id ="${data.messageId}">${data.message} </span>
                                    </div>
                                    <div class="d-flex mesagetime align-items-end d-none">
                                        <span class=" c-grey fs-rem-12">${data.sentAt}</span>
                                    </div>

                                </div>
                            </li>`)
                            $(".chat-message-input").val("");
                            $(document).ready(function() {
                                $('.chat-body-messages').scrollTop($('.chat-body-messages')[0].scrollHeight);
                            });
                            $(".chat-mess").click(function() {
                                $(this).next(".mesagetime").toggleClass("d-none")
                            })

                        },
                        error: function(xhr, status, err) {
                            $(".spinner-border").addClass("d-none")

                            $(".chat-mess").click(function() {
                                $(this).next(".mesagetime").toggleClass("d-none")
                            })
                            console.log(xhr)
                            $(".chat-ul").append(`<li class="w-full c-white mb-10 be-end ">
                                <div class="d-flex fs-rem-14 l-1-2 personal-message mr-px-5 ">
                                    <div class="w-fit rad-10 bg-white p-10 button-bg chat-mess">
                                        <span class="chated-message cur-point" id =""> ${messageFromInput}</span>
                                    </div>
                                    <div class="d-flex mesagetime align-items-end ">
                                        <span class=" c-grey fs-rem-12 c-red">Failed</span>
                                    </div>

                                </div>
                            </li>`)
                            $(".chat-message-input").val("");
                            $(document).ready(function() {
                                $('.chat-body-messages').scrollTop($('.chat-body-messages')[0].scrollHeight);
                            });
                            $(".chat-mess").click(function() {
                                $(this).next(".mesagetime").toggleClass("d-none")
                            })
                        }
                    })
                }

            })


            $("#search2").keypress(function(e) {
                let notRemanningPeople2 = 0;
                if (e.key.toLowerCase() == "enter" && $(this).val().length > 0) {
                    let seachValue = $("#search2").val();
                    $.ajax({
                        "method": "GET",
                        "url": `${apiUrl}/api/Common/GetRecentMessages?Page=1&Size=6&q=${seachValue}`,
                        "xhrFields": {
                            "withCredentials": true
                        },
                        "headers": {
                            "Content-Type": "application/json",
                            "ngrok-skip-browser-warning": "69420",
                            "Accept-Language": language
                        },
                        beforeSend: function() {
                            if (notRemanningPeople2 == 0) {
                                $(".loadingchats").removeClass("d-none")
                            }
                        },
                        success: function(data, st, xhr) {
                            console.log(data);
                            if (data.length == 0 && notRemanningPeople2 == 0) {
                                $(".chat-users-ul").html(``);
                                $(".chat-users-ul").append(`<h4 class = "fs-15 c-grey mt-10 mb-10">No remaining people</h4>`);
                                notRemanningPeople2 = 1;
                                if ((!$(".progress-bar").hasClass("d-none"))) {
                                    $(".progress-bar").addClass("d-none");
                                }
                                if ((!$(".loadingchats").hasClass("d-none"))) {
                                    $(".loadingchats").addClass("d-none");
                                }
                            } else {
                                $(".chat-users-ul").html(``);
                                for (var i = 0; i < data.length; i++) {
                                    let profilesrc;
                                    if (data[i].profilePicture == null) {
                                        profilesrc = "imgs/profilepic.svg"
                                    } else {
                                        profilesrc = "data:image/png;base64," + data[i].profilePicture;
                                    }
                                    $(".chat-users-ul").append(` <a href="?id=${data[i].userId}">  <li class="cur-point mb-20 p-px-5 d-flex flex-row">
                            
                                <div>
                                    <img src=${profilesrc} alt="" style="max-width: 30px; max-height:30px;" class="user-photo mr-px-5 d-none rad-half d-lg-inline">
                                </div>
                                <div class="d-flex flex-column chat-user-text">
                                    <span class="chat-user fw-bold">${data[i].fullName}</span>
                                    <div class="d-flex c-grey fs-rem-12 message-contain${data[i].userId}">
                                        <span class="mr-px-5 chat-tetx c-black">${data[i].lastMessage}</span>
                                        <span class="chat-time">${data[i].lastMessageTime}</span>
                                    </div>
                                </div>
                              
                            </li>  </a>`)

                                    if (data[i].lastMessage == null) {
                                        $(`.message-contain${data[i].userId}`).addClass("d-none");
                                    }
                                }
                                searchBool = true;
                                if ((!$(".progress-bar").hasClass("d-none"))) {
                                    $(".progress-bar").addClass("d-none");
                                }
                                if ((!$(".loadingchats").hasClass("d-none"))) {
                                    $(".loadingchats").addClass("d-none");
                                }
                            }
                        },
                        error: function(xhr, status, err) {

                        }
                    })



                }
            })




            $("#search-icon2").click(function(e) {
                let notRemanningPeople2 = 0;
                if ($("#search2").val().length > 0) {
                    let seachValue = $("#search2").val();
                    $.ajax({
                        "method": "GET",
                        "url": `${apiUrl}/api/Common/GetRecentMessages?Page=1&Size=6&q=${seachValue}`,
                        "xhrFields": {
                            "withCredentials": true
                        },
                        "headers": {
                            "Content-Type": "application/json",
                            "ngrok-skip-browser-warning": "69420",
                            "Accept-Language": language
                        },
                        beforeSend: function() {
                            if (notRemanningPeople2 == 0) {
                                $(".loadingchats").removeClass("d-none")
                            }
                        },
                        success: function(data, st, xhr) {
                            console.log(data);
                            if (data.length == 0 && notRemanningPeople2 == 0) {
                                $(".chat-users-ul").html(``);
                                $(".chat-users-ul").append(`<h4 class = "fs-15 c-grey mt-10 mb-10">No remaining people</h4>`);
                                notRemanningPeople2 = 1;
                                if ((!$(".progress-bar").hasClass("d-none"))) {
                                    $(".progress-bar").addClass("d-none");
                                }
                                if ((!$(".loadingchats").hasClass("d-none"))) {
                                    $(".loadingchats").addClass("d-none");
                                }
                            } else {
                                $(".chat-users-ul").html(``);
                                for (var i = 0; i < data.length; i++) {
                                    let profilesrc;
                                    if (data[i].profilePicture == null) {
                                        profilesrc = "imgs/profilepic.svg"
                                    } else {
                                        profilesrc = "data:image/png;base64," + data[i].profilePicture;
                                    }
                                    $(".chat-users-ul").append(` <a href="?id=${data[i].userId}">  <li class="cur-point mb-20 p-px-5 d-flex flex-row">
                            
                                <div>
                                    <img src=${profilesrc} alt="" style="max-width: 30px; max-height:30px;" class="user-photo mr-px-5 d-none rad-half d-lg-inline">
                                </div>
                                <div class="d-flex flex-column chat-user-text">
                                    <span class="chat-user fw-bold">${data[i].fullName}</span>
                                    <div class="d-flex c-grey fs-rem-12 message-contain${data[i].userId}">
                                        <span class="mr-px-5 chat-tetx c-black">${data[i].lastMessage}</span>
                                        <span class="chat-time">${data[i].lastMessageTime}</span>
                                    </div>
                                </div>
                              
                            </li>  </a>`)

                                    if (data[i].lastMessage == null) {
                                        $(`.message-contain${data[i].userId}`).addClass("d-none");
                                    }
                                }
                                searchBool = true;
                                if ((!$(".progress-bar").hasClass("d-none"))) {
                                    $(".progress-bar").addClass("d-none");
                                }
                                if ((!$(".loadingchats").hasClass("d-none"))) {
                                    $(".loadingchats").addClass("d-none");
                                }
                            }
                        },
                        error: function(xhr, status, err) {

                        }
                    })



                }
            })









            // return recent chated people when clear search 
            $(".remove-search").click(function() {

                $.ajax({
                    "method": "GET",
                    "url": `${apiUrl}/api/Common/GetRecentMessages?Page=1&Size=4`,
                    "xhrFields": {
                        "withCredentials": true
                    },
                    "headers": {
                        "Content-Type": "application/json",
                        "ngrok-skip-browser-warning": "69420",
                        "Accept-Language": language
                    },
                    beforeSend: function() {

                    },
                    success: function(data, st, xhr) {
                        console.log(data);
                        if (data.length > 0) {
                            $("#search2").val("");
                            $(".chat-users-ul").html(``);
                            for (var i = 0; i < data.length; i++) {
                                let profilesrc;
                                if (data[i].profilePicture == null) {
                                    profilesrc = "imgs/profilepic.svg"
                                } else {
                                    profilesrc = "data:image/png;base64," + data[i].profilePicture;
                                }
                                $(".chat-users-ul").append(` <a href="?id=${data[i].userId}">  <li class="cur-point mb-20 p-px-5 d-flex flex-row">
                            
                                <div>
                                    <img src=${profilesrc} alt="" style="max-width: 30px; max-height:30px;" class="user-photo mr-px-5 d-none rad-half d-lg-inline">
                                </div>
                                <div class="d-flex flex-column chat-user-text">
                                    <span class="chat-user fw-bold">${data[i].fullName}</span>
                                    <div class="d-flex c-grey fs-rem-12 ">
                                        <span class="mr-px-5 chat-tetx c-black">${data[i].lastMessage}</span>
                                        <span class="chat-time">${data[i].lastMessageTime}</span>
                                    </div>
                                </div>
                              
                            </li>  </a>`)

                            }
                        }
                        searchBool = false;
                        if ((!$(".progress-bar").hasClass("d-none"))) {
                            $(".progress-bar").addClass("d-none");
                        }
                        if ((!$(".loadingchats").hasClass("d-none"))) {
                            $(".loadingchats").addClass("d-none");
                        }


                    },
                    error: function(xhr, status, err) {

                    }
                })



            })

        })();
    </script>

    <script>
        let url = window.location.href
        url = url.split("?")
        let userId = url[1].split("=")
        userId = userId[1]

        // //request of report button
        // $(`.reportbuton`).click(function(e) {
        //     e.preventDefault();
        //     let postId = $(this).attr("data-post-id");
        //     let parentofButton = $(this).parent();
        //     let perviosDiv = parentofButton.prev()[0];
        //     let textarea = $(perviosDiv).find('textarea')[0];
        //     let reason = $(textarea).val();

        //     let button = $(this);

        //     console.log(reason);
        //     console.log(postId);
        //     let reportObj = {
        //         "reported_post_id": postId,
        //         "reason": reason
        //     }

        //     let jsonData = JSON.stringify(reportObj);

        //     if (reason.length == 0 || reason == null) {
        //         delete reportObj.reason
        //     }
        //     $.ajax({
        //         "method": "POST",
        //         "url": apiUrl + "/api/Common/ReportPost",
        //         "xhrFields": {
        //             "withCredentials": true
        //         },
        //         "headers": {
        //             "Content-Type": "application/json",
        //             "ngrok-skip-browser-warning": "69420",
        //             "Accept-Language": language
        //         },
        //         "data": jsonData,

        //         success: function(data, st, xhr) {
        //             console.log(data);
        //             let buttondiv = $(button).parent()[0];
        //             let errordiv = $(buttondiv).next('div')[0]
        //             let errorspan = $(errordiv).find('span')[0];
        //             $(errorspan).css("color", "green")
        //             $(errorspan).text("Report Sent Sucssfully")

        //             setTimeout(function() {
        //                 let Cancelbutton = $(button).next(`.reportbutoncancel`)[0];
        //                 $(Cancelbutton).trigger('click');
        //             }, 2000)


        //         },
        //         error: function(xhr, status, err) {
        //             let buttondiv = $(button).parent()[0];
        //             let errordiv = $(buttondiv).next('div')[0]
        //             let errorspan = $(errordiv).find('span')[0];
        //             $(errorspan).css("color", "red")
        //             $(errorspan).text(xhr.responseJSON.error)

        //             setTimeout(function() {
        //                 let Cancelbutton = $(button).next(`.reportbutoncancel`)[0];
        //                 $(Cancelbutton).trigger('click');
        //             }, 2000)

        //         }
        //     })
        // });


        //request of block button
        $(`.blockbutton`).click(function(e) {
            e.preventDefault();

            let blockbutton = $(this)
            let blockObj = {
                "blocked_user_id": userId
            }
            let jsonData = JSON.stringify(blockObj);

            $.ajax({
                "method": "POST",
                "url": apiUrl + "/api/Common/BlockUser?blocked_user_id=" + userId,
                "xhrFields": {
                    "withCredentials": true
                },
                "headers": {
                    "Content-Type": "application/json",
                    "ngrok-skip-browser-warning": "69420",
                    "Accept-Language": language
                },


                success: function(data, st, xhr) {


                    $(blockerror2).css("color", "green")
                    $(blockerror2).text("User is blocked")
                    setTimeout(function() {
                        $(".blockbuttoncancel").trigger('click');
                    }, 2000)

                },
                error: function(xhr, status, err) {
                    if (xhr.status == 400) {



                    } else {


                    }


                }
            })

        });
    </script>


    <script>
    </script>

</body>

</html>